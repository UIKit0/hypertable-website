<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: Hypertable::CommitLog Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="namespace_hypertable.html">Hypertable</a>::<a class="el" href="class_hypertable_1_1_commit_log.html">CommitLog</a></div>
<h1>Hypertable::CommitLog Class Reference</h1><!-- doxytag: class="Hypertable::CommitLog" --><!-- doxytag: inherits="Hypertable::CommitLogBase" -->Commit log for persisting range updates.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for Hypertable::CommitLog:</div>
<div class="dynsection">
<p><center><img src="class_hypertable_1_1_commit_log__inherit__graph.png" border="0" usemap="#_hypertable_1_1_commit_log__inherit__map" alt="Inheritance graph"></center>
<map name="_hypertable_1_1_commit_log__inherit__map">
<area shape="rect" href="class_hypertable_1_1_commit_log_base.html" title="Hypertable::CommitLogBase" alt="" coords="5,80,200,107"><area shape="rect" href="class_hypertable_1_1_reference_count.html" title="This class is meant to be a base class for all classes that want to be referenced..." alt="" coords="7,6,199,32"></map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center></div>
<div class="dynheader">
Collaboration diagram for Hypertable::CommitLog:</div>
<div class="dynsection">
<p><center><img src="class_hypertable_1_1_commit_log__coll__graph.png" border="0" usemap="#_hypertable_1_1_commit_log__coll__map" alt="Collaboration graph"></center>
<map name="_hypertable_1_1_commit_log__coll__map">
<area shape="rect" href="class_hypertable_1_1_commit_log_base.html" title="Hypertable::CommitLogBase" alt="" coords="5,173,200,200"><area shape="rect" href="class_hypertable_1_1_reference_count.html" title="This class is meant to be a base class for all classes that want to be referenced..." alt="" coords="155,96,347,123"><area shape="rect" href="class_hypertable_1_1_block_compression_codec.html" title="Abstract base class for block compression codecs." alt="" coords="224,173,472,200"><area shape="rect" href="structatomic__t.html" title="atomic_t" alt="" coords="215,5,287,32"><area shape="rect" href="class_hypertable_1_1_filesystem.html" title="Abstract base class for a filesystem." alt="" coords="496,173,656,200"></map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="class_hypertable_1_1_commit_log-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#8a68373e171577eee2c4d0e5797f5e7d">CommitLog</a> (<a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *fs, const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;log_dir, <a class="el" href="namespace_hypertable.html#8c3eeb0c64dcf09ba41222b111894c12">PropertiesPtr</a> &amp;props_ptr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructs a <a class="el" href="class_hypertable_1_1_commit_log.html" title="Commit log for persisting range updates.">CommitLog</a> object using supplied properties.  <a href="#8a68373e171577eee2c4d0e5797f5e7d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#afde3948d8c0f7eed8f731c172ccc1ac">CommitLog</a> (<a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *fs, const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;log_dir)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructs a <a class="el" href="class_hypertable_1_1_commit_log.html" title="Commit log for persisting range updates.">CommitLog</a> object using default properties.  <a href="#afde3948d8c0f7eed8f731c172ccc1ac"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#10c615b8d9a9bee2505632a92cb72341">~CommitLog</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#5c695ea254af65a47b322588c3405f7b">get_timestamp</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Atomically obtains a timestamp.  <a href="#5c695ea254af65a47b322588c3405f7b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#eebc1e3aba87b2d1b29ca99faca2ffd8">write</a> (<a class="el" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;buffer, uint64_t <a class="el" href="_range_server_8cc.html#4d7e85ea15e60300894d5610b83ab380">timestamp</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a block of updates to the commit log.  <a href="#eebc1e3aba87b2d1b29ca99faca2ffd8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#140542cf96bd9859ec60fbf1fda7eece">link_log</a> (<a class="el" href="class_hypertable_1_1_commit_log_base.html">CommitLogBase</a> *log_base, uint64_t <a class="el" href="_range_server_8cc.html#4d7e85ea15e60300894d5610b83ab380">timestamp</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Links an external log into this log.  <a href="#140542cf96bd9859ec60fbf1fda7eece"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#a71a817375981ed756923923c8bacd94">close</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Closes the log.  <a href="#a71a817375981ed756923923c8bacd94"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#ce2cd51604bd8372c845287dd8154310">purge</a> (uint64_t <a class="el" href="_range_server_8cc.html#4d7e85ea15e60300894d5610b83ab380">timestamp</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Purges the log.  <a href="#ce2cd51604bd8372c845287dd8154310"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#fb3d6dcd8f4c6795c0a832e2835a0d95">load_fragment_priority_map</a> (<a class="el" href="namespace_hypertable.html#e91e25087def3650dae58e3c5efa3900">LogFragmentPriorityMap</a> &amp;frag_map)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fills up a map of per-fragment priority information.  <a href="#fb3d6dcd8f4c6795c0a832e2835a0d95"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#5b6e9122cd2a31935618f63360030820">get_max_fragment_size</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the maximum size of each log fragment file.  <a href="#5b6e9122cd2a31935618f63360030820"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#094c2a1606b26396c9d62b712deecf16">MAGIC_DATA</a> [10] = { 'C','O','M','M','I','T','D','A','T','A' }</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#e5037b08e56aa6f4f923e0c5f373f305">MAGIC_LINK</a> [10] = { 'C','O','M','M','I','T','L','I','N','K' }</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#30b549407c9e9b7c0730353216a23f62">initialize</a> (<a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *fs, const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;log_dir, <a class="el" href="namespace_hypertable.html#8c3eeb0c64dcf09ba41222b111894c12">PropertiesPtr</a> &amp;props_ptr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#86f4b2a04424dfd38814c0c2d9723bdc">roll</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#9412cf9b0435891de25cec0a4702b670">compress_and_write</a> (<a class="el" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;input, <a class="el" href="class_hypertable_1_1_block_compression_header.html">BlockCompressionHeader</a> *header, uint64_t <a class="el" href="_range_server_8cc.html#4d7e85ea15e60300894d5610b83ab380">timestamp</a>)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">boost::mutex&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#6084ca5bf004d98c0a17f9b098ef5f3e">m_mutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#87b904e8aa4896214f9abfb12534ec9c">m_fs</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_hypertable_1_1_block_compression_codec.html">BlockCompressionCodec</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#3a9019594f3e051c3351cd208f286f21">m_compressor</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#2c865dd4604c18ca9366bc18d2e77218">m_cur_fragment_fname</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#ba7b467baf65925714882fd288bc2820">m_cur_fragment_length</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#82de55657ff1b9d1d3d173bcca951165">m_cur_fragment_num</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#f04da6d08397e8f2c4077f72da78014c">m_max_fragment_size</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#bb129d2bbd2d6a1e421eabddf8436d2a">m_fd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_commit_log.html#681849ab3c19e815f61f92b12abf1f01">m_last_timestamp</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Commit log for persisting range updates. 
<p>
The commit log is a directory that contains a growing number of files that contain compressed blocks of "commits". The files are named starting with '0' and will periodically roll, which means that a trailer is written to the end of the file, the file is closed, and then the numeric name is incremented by one and opened. Periodically when old parts of the log are no longer needed, they get purged. The size of each log fragment file is determined by the following config file property: <pre>
 Hypertable.RangeServer.CommitLog.RollLimit
   *</pre> 
<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00070">70</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="8a68373e171577eee2c4d0e5797f5e7d"></a><!-- doxytag: member="Hypertable::CommitLog::CommitLog" ref="8a68373e171577eee2c4d0e5797f5e7d" args="(Filesystem *fs, const String &amp;log_dir, PropertiesPtr &amp;props_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Hypertable::CommitLog::CommitLog           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>log_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespace_hypertable.html#8c3eeb0c64dcf09ba41222b111894c12">PropertiesPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>props_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructs a <a class="el" href="class_hypertable_1_1_commit_log.html" title="Commit log for persisting range updates.">CommitLog</a> object using supplied properties. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filesystem to write log into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>log_dir</em>&nbsp;</td><td>directory of the commit log </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>props_ptr</em>&nbsp;</td><td>reference to properties map </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00080">80</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="afde3948d8c0f7eed8f731c172ccc1ac"></a><!-- doxytag: member="Hypertable::CommitLog::CommitLog" ref="afde3948d8c0f7eed8f731c172ccc1ac" args="(Filesystem *fs, const String &amp;log_dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Hypertable::CommitLog::CommitLog           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>log_dir</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructs a <a class="el" href="class_hypertable_1_1_commit_log.html" title="Commit log for persisting range updates.">CommitLog</a> object using default properties. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filesystem to write log into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>log_dir</em>&nbsp;</td><td>directory of the commit log </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00090">90</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="10c615b8d9a9bee2505632a92cb72341"></a><!-- doxytag: member="Hypertable::CommitLog::~CommitLog" ref="10c615b8d9a9bee2505632a92cb72341" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CommitLog::~CommitLog           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00044">44</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="5c695ea254af65a47b322588c3405f7b"></a><!-- doxytag: member="Hypertable::CommitLog::get_timestamp" ref="5c695ea254af65a47b322588c3405f7b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t CommitLog::get_timestamp           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Atomically obtains a timestamp. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>microseconds since the epoch </dd></dl>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00090">90</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="eebc1e3aba87b2d1b29ca99faca2ffd8"></a><!-- doxytag: member="Hypertable::CommitLog::write" ref="eebc1e3aba87b2d1b29ca99faca2ffd8" args="(DynamicBuffer &amp;buffer, uint64_t timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::write           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>timestamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Writes a block of updates to the commit log. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>block of updates to commit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timestamp</em>&nbsp;</td><td>current commit log time obtained with a call to <a class="el" href="class_hypertable_1_1_commit_log.html#5c695ea254af65a47b322588c3405f7b" title="Atomically obtains a timestamp.">get_timestamp</a> </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><a class="el" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a> on success or error code on failure </dd></dl>

<p>
Compress and write the commit block<p>
Roll the log 
<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00103">103</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="140542cf96bd9859ec60fbf1fda7eece"></a><!-- doxytag: member="Hypertable::CommitLog::link_log" ref="140542cf96bd9859ec60fbf1fda7eece" args="(CommitLogBase *log_base, uint64_t timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::link_log           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_commit_log_base.html">CommitLogBase</a> *&nbsp;</td>
          <td class="paramname"> <em>log_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>timestamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Links an external log into this log. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log_base</em>&nbsp;</td><td>pointer to commit log object to link in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timestamp</em>&nbsp;</td><td>current commit log time obtained with a call to <a class="el" href="class_hypertable_1_1_commit_log.html#5c695ea254af65a47b322588c3405f7b" title="Atomically obtains a timestamp.">get_timestamp</a> </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><a class="el" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a> on success or error code on failure </dd></dl>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00130">130</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="a71a817375981ed756923923c8bacd94"></a><!-- doxytag: member="Hypertable::CommitLog::close" ref="a71a817375981ed756923923c8bacd94" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::close           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Closes the log. 
<p>
Writes the trailer and closes the file<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><a class="el" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a> on success or error code on failure </dd></dl>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00175">175</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="ce2cd51604bd8372c845287dd8154310"></a><!-- doxytag: member="Hypertable::CommitLog::purge" ref="ce2cd51604bd8372c845287dd8154310" args="(uint64_t timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::purge           </td>
          <td>(</td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>timestamp</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Purges the log. 
<p>
Removes all of the log fragments that have a timestamp that is less than the given timestamp.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>timestamp</em>&nbsp;</td><td>real cutoff timestamp </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00198">198</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="fb3d6dcd8f4c6795c0a832e2835a0d95"></a><!-- doxytag: member="Hypertable::CommitLog::load_fragment_priority_map" ref="fb3d6dcd8f4c6795c0a832e2835a0d95" args="(LogFragmentPriorityMap &amp;frag_map)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CommitLog::load_fragment_priority_map           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespace_hypertable.html#e91e25087def3650dae58e3c5efa3900">LogFragmentPriorityMap</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>frag_map</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Fills up a map of per-fragment priority information. 
<p>
One entry per log fragment is inserted into this map. The key is the timestamp of the fragment (e.g. the real timestamp of the most recent data in the fragment file). The value is a structure that contains information regarding how expensive it is to keep this fragment around.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>frag_map</em>&nbsp;</td><td>reference to map of log fragment priority data </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00303">303</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="5b6e9122cd2a31935618f63360030820"></a><!-- doxytag: member="Hypertable::CommitLog::get_max_fragment_size" ref="5b6e9122cd2a31935618f63360030820" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t Hypertable::CommitLog::get_max_fragment_size           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the maximum size of each log fragment file. 
<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00147">147</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="30b549407c9e9b7c0730353216a23f62"></a><!-- doxytag: member="Hypertable::CommitLog::initialize" ref="30b549407c9e9b7c0730353216a23f62" args="(Filesystem *fs, const String &amp;log_dir, PropertiesPtr &amp;props_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CommitLog::initialize           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>log_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespace_hypertable.html#8c3eeb0c64dcf09ba41222b111894c12">PropertiesPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>props_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00049">49</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="86f4b2a04424dfd38814c0c2d9723bdc"></a><!-- doxytag: member="Hypertable::CommitLog::roll" ref="86f4b2a04424dfd38814c0c2d9723bdc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::roll           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00232">232</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="9412cf9b0435891de25cec0a4702b670"></a><!-- doxytag: member="Hypertable::CommitLog::compress_and_write" ref="9412cf9b0435891de25cec0a4702b670" args="(DynamicBuffer &amp;input, BlockCompressionHeader *header, uint64_t timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CommitLog::compress_and_write           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_hypertable_1_1_block_compression_header.html">BlockCompressionHeader</a> *&nbsp;</td>
          <td class="paramname"> <em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>timestamp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8cc-source.html#l00270">270</a> of file <a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a>.</p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="094c2a1606b26396c9d62b712deecf16"></a><!-- doxytag: member="Hypertable::CommitLog::MAGIC_DATA" ref="094c2a1606b26396c9d62b712deecf16" args="[10]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="class_hypertable_1_1_commit_log.html#094c2a1606b26396c9d62b712deecf16">CommitLog::MAGIC_DATA</a> = { 'C','O','M','M','I','T','D','A','T','A' }<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00149">149</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="e5037b08e56aa6f4f923e0c5f373f305"></a><!-- doxytag: member="Hypertable::CommitLog::MAGIC_LINK" ref="e5037b08e56aa6f4f923e0c5f373f305" args="[10]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="class_hypertable_1_1_commit_log.html#e5037b08e56aa6f4f923e0c5f373f305">CommitLog::MAGIC_LINK</a> = { 'C','O','M','M','I','T','L','I','N','K' }<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00150">150</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="6084ca5bf004d98c0a17f9b098ef5f3e"></a><!-- doxytag: member="Hypertable::CommitLog::m_mutex" ref="6084ca5bf004d98c0a17f9b098ef5f3e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex <a class="el" href="class_hypertable_1_1_commit_log.html#6084ca5bf004d98c0a17f9b098ef5f3e">Hypertable::CommitLog::m_mutex</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00158">158</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="87b904e8aa4896214f9abfb12534ec9c"></a><!-- doxytag: member="Hypertable::CommitLog::m_fs" ref="87b904e8aa4896214f9abfb12534ec9c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_hypertable_1_1_filesystem.html">Filesystem</a>* <a class="el" href="class_hypertable_1_1_commit_log.html#87b904e8aa4896214f9abfb12534ec9c">Hypertable::CommitLog::m_fs</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00159">159</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="3a9019594f3e051c3351cd208f286f21"></a><!-- doxytag: member="Hypertable::CommitLog::m_compressor" ref="3a9019594f3e051c3351cd208f286f21" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_hypertable_1_1_block_compression_codec.html">BlockCompressionCodec</a>* <a class="el" href="class_hypertable_1_1_commit_log.html#3a9019594f3e051c3351cd208f286f21">Hypertable::CommitLog::m_compressor</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00160">160</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="2c865dd4604c18ca9366bc18d2e77218"></a><!-- doxytag: member="Hypertable::CommitLog::m_cur_fragment_fname" ref="2c865dd4604c18ca9366bc18d2e77218" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511">String</a> <a class="el" href="class_hypertable_1_1_commit_log.html#2c865dd4604c18ca9366bc18d2e77218">Hypertable::CommitLog::m_cur_fragment_fname</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00161">161</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="ba7b467baf65925714882fd288bc2820"></a><!-- doxytag: member="Hypertable::CommitLog::m_cur_fragment_length" ref="ba7b467baf65925714882fd288bc2820" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_hypertable_1_1_commit_log.html#ba7b467baf65925714882fd288bc2820">Hypertable::CommitLog::m_cur_fragment_length</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00162">162</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="82de55657ff1b9d1d3d173bcca951165"></a><!-- doxytag: member="Hypertable::CommitLog::m_cur_fragment_num" ref="82de55657ff1b9d1d3d173bcca951165" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="class_hypertable_1_1_commit_log.html#82de55657ff1b9d1d3d173bcca951165">Hypertable::CommitLog::m_cur_fragment_num</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00163">163</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="f04da6d08397e8f2c4077f72da78014c"></a><!-- doxytag: member="Hypertable::CommitLog::m_max_fragment_size" ref="f04da6d08397e8f2c4077f72da78014c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t <a class="el" href="class_hypertable_1_1_commit_log.html#f04da6d08397e8f2c4077f72da78014c">Hypertable::CommitLog::m_max_fragment_size</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00164">164</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="bb129d2bbd2d6a1e421eabddf8436d2a"></a><!-- doxytag: member="Hypertable::CommitLog::m_fd" ref="bb129d2bbd2d6a1e421eabddf8436d2a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="class_hypertable_1_1_commit_log.html#bb129d2bbd2d6a1e421eabddf8436d2a">Hypertable::CommitLog::m_fd</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00165">165</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="681849ab3c19e815f61f92b12abf1f01"></a><!-- doxytag: member="Hypertable::CommitLog::m_last_timestamp" ref="681849ab3c19e815f61f92b12abf1f01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="class_hypertable_1_1_commit_log.html#681849ab3c19e815f61f92b12abf1f01">Hypertable::CommitLog::m_last_timestamp</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_commit_log_8h-source.html#l00166">166</a> of file <a class="el" href="_commit_log_8h-source.html">CommitLog.h</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>/Users/doug/src/hypertable/src/cc/Hypertable/Lib/<a class="el" href="_commit_log_8h-source.html">CommitLog.h</a><li>/Users/doug/src/hypertable/src/cc/Hypertable/Lib/<a class="el" href="_commit_log_8cc-source.html">CommitLog.cc</a></ul>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri May 23 14:50:58 2008 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
