<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: /Users/doug/src/hypertable/src/cc/Hypertable/Lib/Schema.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5708de38a757cb70589c505d18009990.html">doug</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a5f6cd2e2a2b5320bbe75e5c719f1fee.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_752ad1e2f45ee7988941467b4eccee0e.html">hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9031e3d7c38caf639b0143600d70b482.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5aae9766518c5969fd00e3382787720.html">cc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_3be4c2a439d9f674975a3d94c602c8e3.html">Hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_ad5135801673f2e4c4e1be66fcd2e528.html">Lib</a>
  </div>
</div>
<div class="contents">
<h1>Schema.cc</h1><a href="_schema_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_compat_8h.html">Common/Compat.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;cctype&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;boost/algorithm/string.hpp&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;expat.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="_file_utils_8h.html">Common/FileUtils.h</a>"</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include "<a class="code" href="_logger_8h.html">Common/Logger.h</a>"</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include "<a class="code" href="_string_ext_8h.html">Common/StringExt.h</a>"</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include "<a class="code" href="_system_8h.html">Common/System.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include "<a class="code" href="_common_2_config_8h.html">Common/Config.h</a>"</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include "<a class="code" href="_schema_8h.html">Schema.h</a>"</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">using namespace </span>Hypertable;
<a name="l00048"></a>00048 <span class="keyword">using namespace </span>Property;
<a name="l00049"></a>00049 <span class="keyword">using namespace </span>std;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <a class="code" href="class_hypertable_1_1_schema.html">Schema</a> *Schema::ms_schema = 0;
<a name="l00052"></a>00052 <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> Schema::ms_collected_text = <span class="stringliteral">""</span>;
<a name="l00053"></a>00053 <a class="code" href="class_hypertable_1_1_mutex.html">Mutex</a> Schema::ms_mutex;
<a name="l00054"></a>00054 <span class="keyword">const</span> uint32_t Schema::ms_max_column_id = 255;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keyword">namespace </span>{
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keywordtype">bool</span> hql_needs_quotes(<span class="keyword">const</span> <span class="keywordtype">char</span> *name) {
<a name="l00059"></a>00059   <span class="keywordflow">if</span> (!isalpha(*name))
<a name="l00060"></a>00060     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00061"></a>00061   <span class="keywordflow">else</span> {
<a name="l00062"></a>00062     <span class="keywordflow">for</span> (; *name; name++) {
<a name="l00063"></a>00063       <span class="keywordflow">if</span> (!isalnum(*name)) {
<a name="l00064"></a>00064         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00065"></a>00065       }
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067   }
<a name="l00068"></a>00068   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <a class="code" href="class_hypertable_1_1_mutex.html">Mutex</a> desc_mutex;
<a name="l00072"></a>00072 <span class="keywordtype">bool</span> desc_inited = <span class="keyword">false</span>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <a class="code" href="namespace_hypertable.html#054109b96c200e93e48a85284e14d265">PropertiesDesc</a>
<a name="l00075"></a>00075   compressor_desc(<span class="stringliteral">"  bmz|lzo|quicklz|zlib|none [compressor_options]\n\n"</span>
<a name="l00076"></a>00076       <span class="stringliteral">"compressor_options"</span>),
<a name="l00077"></a>00077   bloom_filter_desc(<span class="stringliteral">"  rows|rows+cols|none [bloom_filter_options]\n\n"</span>
<a name="l00078"></a>00078       <span class="stringliteral">"  Default bloom filter is defined by the config property:\n"</span>
<a name="l00079"></a>00079       <span class="stringliteral">"  Hypertable.RangeServer.CellStore.DefaultBloomFilter.\n\n"</span>
<a name="l00080"></a>00080       <span class="stringliteral">"bloom_filter_options"</span>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <a class="code" href="namespace_hypertable.html#054109b96c200e93e48a85284e14d265">PropertiesDesc</a> compressor_hidden_desc, bloom_filter_hidden_desc;
<a name="l00083"></a>00083 <a class="code" href="namespace_hypertable.html#a59036b4bb8f2c0a13b86eab5dc62b2a">PositionalDesc</a> compressor_pos_desc, bloom_filter_pos_desc;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keywordtype">void</span> init_schema_options_desc() {
<a name="l00086"></a>00086   <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(desc_mutex);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="keywordflow">if</span> (desc_inited)
<a name="l00089"></a>00089     <span class="keywordflow">return</span>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   compressor_desc.add_options()
<a name="l00092"></a>00092     (<span class="stringliteral">"best,9"</span>, <span class="stringliteral">"Highest setting (probably slower) for zlib"</span>)
<a name="l00093"></a>00093     (<span class="stringliteral">"normal"</span>, <span class="stringliteral">"Normal setting for zlib"</span>)
<a name="l00094"></a>00094     (<span class="stringliteral">"fp-len"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#a5b88b51f5e3caae2e839e1844847e02">i16</a>()-&gt;default_value(19), <span class="stringliteral">"Minimum fingerprint length for bmz"</span>)
<a name="l00095"></a>00095     (<span class="stringliteral">"offset"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#a5b88b51f5e3caae2e839e1844847e02">i16</a>()-&gt;default_value(0), <span class="stringliteral">"Starting fingerprint offset for bmz"</span>)
<a name="l00096"></a>00096     ;
<a name="l00097"></a>00097   compressor_hidden_desc.add_options()
<a name="l00098"></a>00098     (<span class="stringliteral">"compressor-type"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#894a9e1b9934940df29ed0849e4be092">str</a>(), <span class="stringliteral">"Compressor type (bmz|lzo|quicklz|zlib|none)"</span>)
<a name="l00099"></a>00099     ;
<a name="l00100"></a>00100   compressor_pos_desc.add(<span class="stringliteral">"compressor-type"</span>, 1);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   bloom_filter_desc.add_options()
<a name="l00103"></a>00103     (<span class="stringliteral">"false-positive"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#a6c27609e5df823f064e9f48bcdf1c56">f64</a>()-&gt;default_value(0.01), <span class="stringliteral">"Expected false positive "</span>
<a name="l00104"></a>00104         <span class="stringliteral">"probability for the Bloom filter"</span>)
<a name="l00105"></a>00105     (<span class="stringliteral">"max-approx-items"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#0a28e294e980f8b041a595071ae98329">i32</a>()-&gt;default_value(1000), <span class="stringliteral">"Number of cell store "</span>
<a name="l00106"></a>00106         <span class="stringliteral">"items used to guess the number of actual Bloom filter entries"</span>)
<a name="l00107"></a>00107     ;
<a name="l00108"></a>00108   bloom_filter_hidden_desc.add_options()
<a name="l00109"></a>00109     (<span class="stringliteral">"bloom-filter-mode"</span>, <a class="code" href="namespace_hypertable_1_1_property.html#894a9e1b9934940df29ed0849e4be092">str</a>(), <span class="stringliteral">"Bloom filter mode (rows|rows+cols|none)"</span>)
<a name="l00110"></a>00110     ;
<a name="l00111"></a>00111   bloom_filter_pos_desc.add(<span class="stringliteral">"bloom-filter-mode"</span>, 1);
<a name="l00112"></a>00112   desc_inited = <span class="keyword">true</span>;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 } <span class="comment">// local namespace</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="class_hypertable_1_1_schema.html#0206c5a3c264cbb0bafe5b658114cae3">00118</a> Schema::Schema(<span class="keywordtype">bool</span> read_ids)
<a name="l00119"></a>00119   : m_error_string(), m_next_column_id(0), m_access_group_map(),
<a name="l00120"></a>00120     m_column_family_map(), m_generation(1), m_access_groups(),
<a name="l00121"></a>00121     m_open_access_group(0), m_open_column_family(0), m_read_ids(read_ids),
<a name="l00122"></a>00122     m_output_ids(false), m_max_column_family_id(0) {
<a name="l00123"></a>00123 }
<a name="l00127"></a><a class="code" href="class_hypertable_1_1_schema.html#f5d8b5b42648e3eb2ef55b598baf587f">00127</a> <a class="code" href="class_hypertable_1_1_schema.html#0206c5a3c264cbb0bafe5b658114cae3">Schema::Schema</a>(<span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_schema.html">Schema</a> &amp;src_schema)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129   <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *ag;
<a name="l00130"></a>00130   <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="comment">// Set schema attributes</span>
<a name="l00133"></a>00133   <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a>;
<a name="l00134"></a>00134   <a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a>;
<a name="l00135"></a>00135   <a class="code" href="class_hypertable_1_1_schema.html#251bc5dc6353d32e2070f98cb84ed148">m_next_column_id</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#251bc5dc6353d32e2070f98cb84ed148">m_next_column_id</a>;
<a name="l00136"></a>00136   <a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a>;
<a name="l00137"></a>00137   <a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a>;
<a name="l00138"></a>00138   <a class="code" href="class_hypertable_1_1_schema.html#c488d5489d6d4963ef8bfffe4b1c7c65">m_output_ids</a> = src_schema.<a class="code" href="class_hypertable_1_1_schema.html#c488d5489d6d4963ef8bfffe4b1c7c65">m_output_ids</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   <span class="comment">// Create access groups</span>
<a name="l00141"></a>00141   <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *src_ag, src_schema.<a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>) {
<a name="l00142"></a>00142     ag = <span class="keyword">new</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">Schema::AccessGroup</a>();
<a name="l00143"></a>00143     ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a> = src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>;
<a name="l00144"></a>00144     ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a> = src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a>;
<a name="l00145"></a>00145     ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a> = src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a>;
<a name="l00146"></a>00146     ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a> = src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a>;
<a name="l00147"></a>00147     ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a> = src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.insert(make_pair(ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>, ag));
<a name="l00150"></a>00150     <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>.push_back(ag);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="comment">// Populate access group with column families</span>
<a name="l00153"></a>00153     <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *src_cf, src_ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>) {
<a name="l00154"></a>00154       cf = <span class="keyword">new</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">Schema::ColumnFamily</a>(*src_cf);
<a name="l00155"></a>00155       <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.insert(make_pair(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>, cf));
<a name="l00156"></a>00156       <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.push_back(cf);
<a name="l00157"></a>00157       ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>.push_back(cf);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="class_hypertable_1_1_schema.html#fbc49c08e6c07e4a252e0b4a2f01b231">00162</a> <a class="code" href="class_hypertable_1_1_schema.html#fbc49c08e6c07e4a252e0b4a2f01b231">Schema::~Schema</a>() {
<a name="l00163"></a>00163   <span class="keywordflow">foreach</span>(<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *ag, <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>)
<a name="l00164"></a>00164     <span class="keyword">delete</span> ag;
<a name="l00165"></a>00165   <span class="keywordflow">foreach</span>(<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf, <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>)
<a name="l00166"></a>00166     <span class="keyword">delete</span> cf;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="class_hypertable_1_1_schema.html#05b45dcae5ecf3c28d06067d8f74b8e1">00170</a> <a class="code" href="class_hypertable_1_1_schema.html">Schema</a> *<a class="code" href="class_hypertable_1_1_schema.html#05b45dcae5ecf3c28d06067d8f74b8e1">Schema::new_instance</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">bool</span> read_ids) {
<a name="l00171"></a>00171   <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(<a class="code" href="class_hypertable_1_1_schema.html#8e845e9d7e8c0281a6edfe871f5908a0">ms_mutex</a>);
<a name="l00172"></a>00172   XML_Parser parser = XML_ParserCreate(<span class="stringliteral">"US-ASCII"</span>);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   XML_SetElementHandler(parser, &amp;<a class="code" href="class_hypertable_1_1_schema.html#3bdf945a0f4f7c38dd000189d077f622">start_element_handler</a>, &amp;<a class="code" href="class_hypertable_1_1_schema.html#bcefb69969e39a5bcb165f3c795ea387">end_element_handler</a>);
<a name="l00175"></a>00175   XML_SetCharacterDataHandler(parser, &amp;<a class="code" href="class_hypertable_1_1_schema.html#aa2b61f38fc5fe9de5b96a2c72ba499c">character_data_handler</a>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a> = <span class="keyword">new</span> <a class="code" href="class_hypertable_1_1_schema.html#0206c5a3c264cbb0bafe5b658114cae3">Schema</a>(read_ids);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   <span class="keywordflow">if</span> (XML_Parse(parser, buf, len, 1) == 0) {
<a name="l00180"></a>00180     <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> errstr = (<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Schema Parse Error: "</span>
<a name="l00181"></a>00181         + (<span class="keyword">const</span> <span class="keywordtype">char</span> *)XML_ErrorString(XML_GetErrorCode(parser))
<a name="l00182"></a>00182         + <span class="stringliteral">" line "</span> + (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)XML_GetCurrentLineNumber(parser) + <span class="stringliteral">", offset "</span>
<a name="l00183"></a>00183         + (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)XML_GetCurrentByteIndex(parser);
<a name="l00184"></a>00184     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(errstr);
<a name="l00185"></a>00185   }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   XML_ParserFree(parser);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <a class="code" href="class_hypertable_1_1_schema.html">Schema</a> *schema = <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>;
<a name="l00190"></a>00190   <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a> = 0;
<a name="l00191"></a>00191   <span class="keywordflow">return</span> schema;
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="class_hypertable_1_1_schema.html#43d3af0c3d178a44e5582567483d4548">00195</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#43d3af0c3d178a44e5582567483d4548">Schema::parse_compressor</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;compressor, <a class="code" href="namespace_hypertable.html#3c17fee96d466b253b38bf89565838ff">PropertiesPtr</a> &amp;props) {
<a name="l00196"></a>00196   init_schema_options_desc();
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   vector&lt;String&gt; args;
<a name="l00199"></a>00199   boost::split(args, compressor, boost::is_any_of(<span class="stringliteral">" \t"</span>));
<a name="l00200"></a>00200   <a class="code" href="_error_8h.html#2d697a9a3513b9d966fb2669532ef5cd">HT_TRY</a>(<span class="stringliteral">"parsing compressor spec"</span>,
<a name="l00201"></a>00201     props-&gt;parse_args(args, compressor_desc, &amp;compressor_hidden_desc,
<a name="l00202"></a>00202                       &amp;compressor_pos_desc));
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="class_hypertable_1_1_schema.html#0bc4e76ebf99e4b4816de55c1dfe059f">00206</a> <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#054109b96c200e93e48a85284e14d265">PropertiesDesc</a> &amp;<a class="code" href="class_hypertable_1_1_schema.html#0bc4e76ebf99e4b4816de55c1dfe059f">Schema::compressor_spec_desc</a>() {
<a name="l00207"></a>00207   init_schema_options_desc();
<a name="l00208"></a>00208   <span class="keywordflow">return</span> compressor_desc;
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="keywordtype">void</span>
<a name="l00213"></a><a class="code" href="class_hypertable_1_1_schema.html#b8fe3a1ed1b6b676e0298352817f6b43">00213</a> <a class="code" href="class_hypertable_1_1_schema.html#b8fe3a1ed1b6b676e0298352817f6b43">Schema::parse_bloom_filter</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;bloom_filter, <a class="code" href="namespace_hypertable.html#3c17fee96d466b253b38bf89565838ff">PropertiesPtr</a> &amp;props) {
<a name="l00214"></a>00214   init_schema_options_desc();
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   vector&lt;String&gt; args;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   boost::split(args, bloom_filter, boost::is_any_of(<span class="stringliteral">" \t"</span>));
<a name="l00219"></a>00219   <a class="code" href="_error_8h.html#2d697a9a3513b9d966fb2669532ef5cd">HT_TRY</a>(<span class="stringliteral">"parsing bloom filter spec"</span>,
<a name="l00220"></a>00220     props-&gt;parse_args(args, bloom_filter_desc, &amp;bloom_filter_hidden_desc,
<a name="l00221"></a>00221                       &amp;bloom_filter_pos_desc));
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> mode = props-&gt;get_str(<span class="stringliteral">"bloom-filter-mode"</span>);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225   <span class="keywordflow">if</span> (mode == <span class="stringliteral">"none"</span> || mode == <span class="stringliteral">"disabled"</span>)
<a name="l00226"></a>00226     props-&gt;set(<span class="stringliteral">"bloom-filter-mode"</span>, <a class="code" href="namespace_hypertable.html#38d1fe48d49de0172bb2f603833a00a788a596a56393a14e21c871b476f7524b">BLOOM_FILTER_DISABLED</a>);
<a name="l00227"></a>00227   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">"rows"</span> || mode == <span class="stringliteral">"row"</span>)
<a name="l00228"></a>00228     props-&gt;set(<span class="stringliteral">"bloom-filter-mode"</span>, <a class="code" href="namespace_hypertable.html#38d1fe48d49de0172bb2f603833a00a75c596c7d52121b05ae12c36e83df2e22">BLOOM_FILTER_ROWS</a>);
<a name="l00229"></a>00229   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="stringliteral">"rows+cols"</span> || mode == <span class="stringliteral">"row+col"</span>
<a name="l00230"></a>00230            || mode == <span class="stringliteral">"rows-cols"</span> || mode == <span class="stringliteral">"row-col"</span>
<a name="l00231"></a>00231            || mode == <span class="stringliteral">"rows_cols"</span> || mode == <span class="stringliteral">"row_col"</span>)
<a name="l00232"></a>00232     props-&gt;set(<span class="stringliteral">"bloom-filter-mode"</span>, <a class="code" href="namespace_hypertable.html#38d1fe48d49de0172bb2f603833a00a7f71decbbdf84e82877c9ffae2b36e817">BLOOM_FILTER_ROWS_COLS</a>);
<a name="l00233"></a>00233   <span class="keywordflow">else</span> <a class="code" href="_error_8h.html#a274083bca13ee78497570285c908c80">HT_THROWF</a>(<a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b28a5a59aa0e7adf59fa4f92bf15e0f9e6">Error::BAD_SCHEMA</a>, <span class="stringliteral">"unknown bloom filter mode: '%s'"</span>,
<a name="l00234"></a>00234                  mode.c_str());
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="class_hypertable_1_1_schema.html#ad69f14b09ab3c227ba7ccc634c0334f">00238</a> <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#054109b96c200e93e48a85284e14d265">PropertiesDesc</a> &amp;<a class="code" href="class_hypertable_1_1_schema.html#ad69f14b09ab3c227ba7ccc634c0334f">Schema::bloom_filter_spec_desc</a>() {
<a name="l00239"></a>00239   init_schema_options_desc();
<a name="l00240"></a>00240   <span class="keywordflow">return</span> bloom_filter_desc;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="class_hypertable_1_1_schema.html#0d901be0d0fcad20592b6315adf2cdbb">00244</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#0d901be0d0fcad20592b6315adf2cdbb">Schema::validate_compressor</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;compressor) {
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (compressor.empty())
<a name="l00246"></a>00246     <span class="keywordflow">return</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <span class="keywordflow">try</span> {
<a name="l00249"></a>00249     <a class="code" href="namespace_hypertable.html#3c17fee96d466b253b38bf89565838ff">PropertiesPtr</a> props = <span class="keyword">new</span> <a class="code" href="class_hypertable_1_1_properties.html">Properties</a>();
<a name="l00250"></a>00250     <a class="code" href="class_hypertable_1_1_schema.html#43d3af0c3d178a44e5582567483d4548">parse_compressor</a>(compressor, props);
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00253"></a>00253     ostringstream oss;
<a name="l00254"></a>00254     oss &lt;&lt; e;
<a name="l00255"></a>00255     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(oss.str());
<a name="l00256"></a>00256   }
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="class_hypertable_1_1_schema.html#fc61b32d634926197545bd91a80b373e">00260</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#fc61b32d634926197545bd91a80b373e">Schema::validate_bloom_filter</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;bloom_filter) {
<a name="l00261"></a>00261   <span class="keywordflow">if</span> (bloom_filter.empty())
<a name="l00262"></a>00262     <span class="keywordflow">return</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="keywordflow">try</span> {
<a name="l00265"></a>00265     <a class="code" href="namespace_hypertable.html#3c17fee96d466b253b38bf89565838ff">PropertiesPtr</a> props = <span class="keyword">new</span> <a class="code" href="class_hypertable_1_1_properties.html">Properties</a>();
<a name="l00266"></a>00266     <a class="code" href="class_hypertable_1_1_schema.html#b8fe3a1ed1b6b676e0298352817f6b43">parse_bloom_filter</a>(bloom_filter, props);
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00269"></a>00269     ostringstream oss;
<a name="l00270"></a>00270     oss &lt;&lt; e;
<a name="l00271"></a>00271     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(oss.str());
<a name="l00272"></a>00272   }
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 
<a name="l00278"></a><a class="code" href="class_hypertable_1_1_schema.html#3bdf945a0f4f7c38dd000189d077f622">00278</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#3bdf945a0f4f7c38dd000189d077f622">Schema::start_element_handler</a>(<span class="keywordtype">void</span> *userdata,
<a name="l00279"></a>00279                          <span class="keyword">const</span> XML_Char *name,
<a name="l00280"></a>00280                          <span class="keyword">const</span> XML_Char **atts) {
<a name="l00281"></a>00281   <span class="keywordtype">int</span> i;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"Schema"</span>)) {
<a name="l00284"></a>00284     <span class="keywordflow">for</span> (i=0; atts[i] != 0; i+=2) {
<a name="l00285"></a>00285       <span class="keywordflow">if</span> (atts[i+1] == 0)
<a name="l00286"></a>00286         <span class="keywordflow">return</span>;
<a name="l00287"></a>00287       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a> &amp;&amp; !strcasecmp(atts[i], <span class="stringliteral">"generation"</span>))
<a name="l00288"></a>00288         <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#5e36d56aef59e6d96e6d8839fafe7e6c">set_generation</a>(atts[i+1]);
<a name="l00289"></a>00289       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(atts[i], <span class="stringliteral">"compressor"</span>))
<a name="l00290"></a>00290         <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#63ebd37cf72d7cd0cd879a617a0155f0">set_compressor</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)atts[i+1]);
<a name="l00291"></a>00291       <span class="keywordflow">else</span>
<a name="l00292"></a>00292         <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Unrecognized 'Schema' attribute : "</span>
<a name="l00293"></a>00293                                      + atts[i]);
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"AccessGroup"</span>)) {
<a name="l00297"></a>00297     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#b58ce95c806214b03940447c07e65605">open_access_group</a>();
<a name="l00298"></a>00298     <span class="keywordflow">for</span> (i=0; atts[i] != 0; i+=2) {
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (atts[i+1] == 0)
<a name="l00300"></a>00300         <span class="keywordflow">return</span>;
<a name="l00301"></a>00301       <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#f7353770a71ea8c3d9431fe900710a6c">set_access_group_parameter</a>(atts[i], atts[i+1]);
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303   }
<a name="l00304"></a>00304   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"ColumnFamily"</span>)) {
<a name="l00305"></a>00305     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#a9f7ba89aae544a15ef395726d38ccc4">open_column_family</a>();
<a name="l00306"></a>00306     <span class="keywordflow">for</span> (i=0; atts[i] != 0; i+=2) {
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (atts[i+1] == 0)
<a name="l00308"></a>00308         <span class="keywordflow">return</span>;
<a name="l00309"></a>00309       <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#9f215c29b00785b426ebe0fb3500f7ee">set_column_family_parameter</a>(atts[i], atts[i+1]);
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"MaxVersions"</span>) || !strcasecmp(name, <span class="stringliteral">"ttl"</span>)
<a name="l00313"></a>00313            || !strcasecmp(name, <span class="stringliteral">"Name"</span>) || !strcasecmp(name, <span class="stringliteral">"Generation"</span>)
<a name="l00314"></a>00314            || !strcasecmp(name, <span class="stringliteral">"deleted"</span>))
<a name="l00315"></a>00315     <a class="code" href="class_hypertable_1_1_schema.html#a5b67b8bb2ae5728398f3d280e207eb5">ms_collected_text</a> = <span class="stringliteral">""</span>;
<a name="l00316"></a>00316   <span class="keywordflow">else</span>
<a name="l00317"></a>00317     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(<a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"Unrecognized element - '%s'"</span>, name));
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="keywordflow">return</span>;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="class_hypertable_1_1_schema.html#bcefb69969e39a5bcb165f3c795ea387">00323</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#bcefb69969e39a5bcb165f3c795ea387">Schema::end_element_handler</a>(<span class="keywordtype">void</span> *userdata, <span class="keyword">const</span> XML_Char *name) {
<a name="l00324"></a>00324   <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"AccessGroup"</span>))
<a name="l00325"></a>00325     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#f86a9a41ec7609766570f28ef5cede88">close_access_group</a>();
<a name="l00326"></a>00326   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"ColumnFamily"</span>))
<a name="l00327"></a>00327     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#802629316e539d6c8d70c1519ece1266">close_column_family</a>();
<a name="l00328"></a>00328   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">"MaxVersions"</span>) || !strcasecmp(name, <span class="stringliteral">"ttl"</span>)
<a name="l00329"></a>00329            || !strcasecmp(name, <span class="stringliteral">"Name"</span>) || !strcasecmp(name, <span class="stringliteral">"Generation"</span>)
<a name="l00330"></a>00330            || !strcasecmp(name, <span class="stringliteral">"deleted"</span>)) {
<a name="l00331"></a>00331     boost::trim(<a class="code" href="class_hypertable_1_1_schema.html#a5b67b8bb2ae5728398f3d280e207eb5">ms_collected_text</a>);
<a name="l00332"></a>00332     <a class="code" href="class_hypertable_1_1_schema.html#5f8c38b2c51f65af1b509c0e3afb7fae">ms_schema</a>-&gt;<a class="code" href="class_hypertable_1_1_schema.html#9f215c29b00785b426ebe0fb3500f7ee">set_column_family_parameter</a>(name, <a class="code" href="class_hypertable_1_1_schema.html#a5b67b8bb2ae5728398f3d280e207eb5">ms_collected_text</a>.c_str());
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="class_hypertable_1_1_schema.html#aa2b61f38fc5fe9de5b96a2c72ba499c">00339</a> <a class="code" href="class_hypertable_1_1_schema.html#aa2b61f38fc5fe9de5b96a2c72ba499c">Schema::character_data_handler</a>(<span class="keywordtype">void</span> *userdata, <span class="keyword">const</span> XML_Char *s, <span class="keywordtype">int</span> len) {
<a name="l00340"></a>00340   <a class="code" href="class_hypertable_1_1_schema.html#a5b67b8bb2ae5728398f3d280e207eb5">ms_collected_text</a>.assign(s, len);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a><a class="code" href="class_hypertable_1_1_schema.html#b58ce95c806214b03940447c07e65605">00345</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#b58ce95c806214b03940447c07e65605">Schema::open_access_group</a>() {
<a name="l00346"></a>00346   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> != 0)
<a name="l00347"></a>00347     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Nested AccessGroup elements not allowed"</span>);
<a name="l00348"></a>00348   <span class="keywordflow">else</span> {
<a name="l00349"></a>00349     <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> = <span class="keyword">new</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a>();
<a name="l00350"></a>00350   }
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="class_hypertable_1_1_schema.html#f86a9a41ec7609766570f28ef5cede88">00355</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#f86a9a41ec7609766570f28ef5cede88">Schema::close_access_group</a>() {
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> == 0)
<a name="l00357"></a>00357     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Unable to close locality group, not open"</span>);
<a name="l00358"></a>00358   <span class="keywordflow">else</span> {
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a> == <span class="stringliteral">""</span>)
<a name="l00360"></a>00360       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(<span class="stringliteral">"Name attribute required for all AccessGroup elements"</span>);
<a name="l00361"></a>00361     <span class="keywordflow">else</span> {
<a name="l00362"></a>00362       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.find(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>)
<a name="l00363"></a>00363           != <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.end())
<a name="l00364"></a>00364         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Multiply defined locality group '"</span>
<a name="l00365"></a>00365                           + <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a> + <span class="stringliteral">"'"</span>);
<a name="l00366"></a>00366       <span class="keywordflow">else</span> {
<a name="l00367"></a>00367         <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>[<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>] = <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>;
<a name="l00368"></a>00368         <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>.push_back(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>);
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371     <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> = 0;
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="class_hypertable_1_1_schema.html#a9f7ba89aae544a15ef395726d38ccc4">00377</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#a9f7ba89aae544a15ef395726d38ccc4">Schema::open_column_family</a>() {
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> == 0)
<a name="l00379"></a>00379     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"ColumnFamily defined outside of AccessGroup"</span>);
<a name="l00380"></a>00380   <span class="keywordflow">else</span> {
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a> != 0)
<a name="l00382"></a>00382       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Nested ColumnFamily elements not allowed"</span>);
<a name="l00383"></a>00383     <span class="keywordflow">else</span> {
<a name="l00384"></a>00384       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a> = <span class="keyword">new</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a>();
<a name="l00385"></a>00385       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> = 0;
<a name="l00386"></a>00386       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a> = 0;
<a name="l00387"></a>00387       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a> = 0;
<a name="l00388"></a>00388       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a> = <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>;
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="class_hypertable_1_1_schema.html#802629316e539d6c8d70c1519ece1266">00395</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#802629316e539d6c8d70c1519ece1266">Schema::close_column_family</a>() {
<a name="l00396"></a>00396   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> == 0)
<a name="l00397"></a>00397     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"ColumnFamily defined outside of AccessGroup"</span>);
<a name="l00398"></a>00398   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a> == 0)
<a name="l00399"></a>00399     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Unable to close column family, not open"</span>);
<a name="l00400"></a>00400   <span class="keywordflow">else</span> {
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> == <span class="stringliteral">""</span>)
<a name="l00402"></a>00402       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"ColumnFamily must have Name child element"</span>);
<a name="l00403"></a>00403     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a> &amp;&amp; <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> == 0) {
<a name="l00404"></a>00404       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"No id specifid for ColumnFamily '"</span>
<a name="l00405"></a>00405                         + <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> + <span class="stringliteral">"'"</span>);
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407     <span class="keywordflow">else</span> {
<a name="l00408"></a>00408       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.find(<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>)
<a name="l00409"></a>00409           != <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.end())
<a name="l00410"></a>00410         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Multiply defined column families '"</span>
<a name="l00411"></a>00411                           + <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> + <span class="stringliteral">"'"</span>);
<a name="l00412"></a>00412       <span class="keywordflow">else</span> {
<a name="l00413"></a>00413         <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>[<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>] = <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>;
<a name="l00414"></a>00414         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a>)
<a name="l00415"></a>00415           <a class="code" href="class_hypertable_1_1_schema.html#c91f0409cf79c95cac93f79ac070329b">m_column_family_id_map</a>[<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a>] =
<a name="l00416"></a>00416               <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>;
<a name="l00417"></a>00417         <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>.push_back(<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>);
<a name="l00418"></a>00418         <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.push_back(<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>);
<a name="l00419"></a>00419       }
<a name="l00420"></a>00420       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a> = 0;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422   }
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="class_hypertable_1_1_schema.html#f7353770a71ea8c3d9431fe900710a6c">00427</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#f7353770a71ea8c3d9431fe900710a6c">Schema::set_access_group_parameter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *param, <span class="keyword">const</span> <span class="keywordtype">char</span> *value) {
<a name="l00428"></a>00428   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a> == 0)
<a name="l00429"></a>00429     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Unable to set AccessGroup attribute '"</span> + param
<a name="l00430"></a>00430                       + <span class="stringliteral">"', locality group not open"</span>);
<a name="l00431"></a>00431   <span class="keywordflow">else</span> {
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"name"</span>))
<a name="l00433"></a>00433       <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a> = value;
<a name="l00434"></a>00434     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"inMemory"</span>)) {
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (!strcasecmp(value, <span class="stringliteral">"true"</span>) || !strcmp(value, <span class="stringliteral">"1"</span>))
<a name="l00436"></a>00436         <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a> = <span class="keyword">true</span>;
<a name="l00437"></a>00437       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(value, <span class="stringliteral">"false"</span>) || !strcmp(value, <span class="stringliteral">"0"</span>))
<a name="l00438"></a>00438         <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a> = <span class="keyword">false</span>;
<a name="l00439"></a>00439       <span class="keywordflow">else</span>
<a name="l00440"></a>00440         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid value ("</span> + value
<a name="l00441"></a>00441                           + <span class="stringliteral">") for AccessGroup attribute '"</span> + param + <span class="stringliteral">"'"</span>);
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"blksz"</span>)) {
<a name="l00444"></a>00444       <span class="keywordtype">long</span> <span class="keywordtype">long</span> blocksize = strtoll(value, 0, 10);
<a name="l00445"></a>00445       <span class="keywordflow">if</span> (blocksize == 0 || blocksize &gt;= 4294967296LL)
<a name="l00446"></a>00446         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid value ("</span> + value
<a name="l00447"></a>00447                           + <span class="stringliteral">") for AccessGroup attribute '"</span> + param + <span class="stringliteral">"'"</span>);
<a name="l00448"></a>00448       <span class="keywordflow">else</span>
<a name="l00449"></a>00449         <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a> = (uint32_t)blocksize;
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"compressor"</span>)) {
<a name="l00452"></a>00452       <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a> = value;
<a name="l00453"></a>00453       boost::trim(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a>);
<a name="l00454"></a>00454       <a class="code" href="class_hypertable_1_1_schema.html#0d901be0d0fcad20592b6315adf2cdbb">validate_compressor</a>(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a>);
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"bloomFilter"</span>)) {
<a name="l00457"></a>00457       <a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a> = value;
<a name="l00458"></a>00458       boost::trim(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a>);
<a name="l00459"></a>00459       <a class="code" href="class_hypertable_1_1_schema.html#fc61b32d634926197545bd91a80b373e">validate_bloom_filter</a>(<a class="code" href="class_hypertable_1_1_schema.html#d7f800e677f5db022bdd4d198e3b20cd">m_open_access_group</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a>);
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461     <span class="keywordflow">else</span>
<a name="l00462"></a>00462       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<span class="keywordtype">string</span>)<span class="stringliteral">"Invalid AccessGroup attribute '"</span> + param + <span class="stringliteral">"'"</span>);
<a name="l00463"></a>00463   }
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="class_hypertable_1_1_schema.html#9f215c29b00785b426ebe0fb3500f7ee">00468</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#9f215c29b00785b426ebe0fb3500f7ee">Schema::set_column_family_parameter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *param, <span class="keyword">const</span> <span class="keywordtype">char</span> *value) {
<a name="l00469"></a>00469   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a> == 0)
<a name="l00470"></a>00470     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Unable to set ColumnFamily parameter '"</span> + param
<a name="l00471"></a>00471                       + <span class="stringliteral">"', column family not open"</span>);
<a name="l00472"></a>00472   <span class="keywordflow">else</span> {
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"Name"</span>))
<a name="l00474"></a>00474       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> = value;
<a name="l00475"></a>00475     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"ttl"</span>)) {
<a name="l00476"></a>00476       <span class="keywordtype">long</span> <span class="keywordtype">long</span> secs = strtoll(value, 0, 10);
<a name="l00477"></a>00477       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a> = (time_t)secs;
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"deleted"</span>)) {
<a name="l00480"></a>00480       <span class="keywordflow">if</span> (!strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00481"></a>00481         <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a> = <span class="keyword">true</span>;
<a name="l00482"></a>00482       <span class="keywordflow">else</span>
<a name="l00483"></a>00483         <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a> = <span class="keyword">false</span>;
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(param, <span class="stringliteral">"MaxVersions"</span>)) {
<a name="l00486"></a>00486       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a> = atoi(value);
<a name="l00487"></a>00487       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a> == 0)
<a name="l00488"></a>00488         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid value ("</span> + value
<a name="l00489"></a>00489                           + <span class="stringliteral">") for MaxVersions"</span>);
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a> &amp;&amp; !strcasecmp(param, <span class="stringliteral">"id"</span>)) {
<a name="l00492"></a>00492       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> = atoi(value);
<a name="l00493"></a>00493       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> == 0)
<a name="l00494"></a>00494         <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid value ("</span> + value
<a name="l00495"></a>00495                           + <span class="stringliteral">") for ColumnFamily id attribute"</span>);
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> &gt; <a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a>)
<a name="l00497"></a>00497         <a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a> = <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a>;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#b89b8b0cc448bdf299ff69526e2d7480">m_read_ids</a> &amp;&amp; !strcasecmp(param, <span class="stringliteral">"Generation"</span>)) {
<a name="l00500"></a>00500       <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a> = atoi(value);
<a name="l00501"></a>00501       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a> == 0)
<a name="l00502"></a>00502         <a class="code" href="class_hypertable_1_1_schema.html#4129a2b366689d1abaa5eb54ced6f57c">m_open_column_family</a>-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a> = <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a>;
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="keywordflow">else</span>
<a name="l00507"></a>00507       <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>(<a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"Invalid ColumnFamily parameter '%s'"</span>, param));
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="class_hypertable_1_1_schema.html#feb7ecf255406a938be3523c0cc56e81">00512</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#feb7ecf255406a938be3523c0cc56e81">Schema::assign_ids</a>() {
<a name="l00513"></a>00513   <a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a> = 0;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a> = 1;
<a name="l00516"></a>00516   <a class="code" href="class_hypertable_1_1_schema.html#c488d5489d6d4963ef8bfffe4b1c7c65">m_output_ids</a>=<span class="keyword">true</span>;
<a name="l00517"></a>00517   <span class="keywordflow">foreach</span>(<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf, <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>) {
<a name="l00518"></a>00518     cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a> = ++<a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a>;
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a> == 0)
<a name="l00520"></a>00520       cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a> = <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a>;
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a><a class="code" href="class_hypertable_1_1_schema.html#43c4c9447ff16b9d39fae1a3e0ffce89">00525</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#43c4c9447ff16b9d39fae1a3e0ffce89">Schema::render</a>(<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;output, <span class="keywordtype">bool</span> with_ids) {
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (!<a class="code" href="class_hypertable_1_1_schema.html#83436b0f8fb8147c7b11f26a67f6655f" title="Protected methods.">is_valid</a>()) {
<a name="l00527"></a>00527     output = <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a>;
<a name="l00528"></a>00528     <span class="keywordflow">return</span>;
<a name="l00529"></a>00529   }
<a name="l00530"></a>00530   output += <span class="stringliteral">"&lt;Schema"</span>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#c488d5489d6d4963ef8bfffe4b1c7c65">m_output_ids</a> || with_ids) {
<a name="l00533"></a>00533     output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" generation=\"%d\""</span>, <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a>);
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a> != <span class="stringliteral">""</span>)
<a name="l00537"></a>00537     output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" compressor=\"%s\""</span>, <a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a>.c_str());
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   output += <span class="stringliteral">"&gt;\n"</span>;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541   <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *ag, <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>) {
<a name="l00542"></a>00542     output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"  &lt;AccessGroup name=\"%s\""</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>.c_str());
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a>)
<a name="l00545"></a>00545       output += <span class="stringliteral">" inMemory=\"true\""</span>;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a> &gt; 0)
<a name="l00548"></a>00548       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" blksz=\"%u\""</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a>);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a> != <span class="stringliteral">""</span>)
<a name="l00551"></a>00551       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" compressor=\"%s\""</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a>.c_str());
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a> != <span class="stringliteral">""</span>)
<a name="l00554"></a>00554       output += (<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">" bloomFilter=\""</span> + ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a> + <span class="stringliteral">"\""</span>;
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     output += <span class="stringliteral">"&gt;\n"</span>;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>) {
<a name="l00559"></a>00559       output += <span class="stringliteral">"    &lt;ColumnFamily"</span>;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#c488d5489d6d4963ef8bfffe4b1c7c65">m_output_ids</a> || with_ids) {
<a name="l00562"></a>00562         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" id=\"%u\""</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a>);
<a name="l00563"></a>00563         output += <span class="stringliteral">"&gt;\n"</span>;
<a name="l00564"></a>00564         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;Generation&gt;%u&lt;/Generation&gt;\n"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#54892ad8f68af20218af6e9b9120efe0">generation</a>);
<a name="l00565"></a>00565       }
<a name="l00566"></a>00566       <span class="keywordflow">else</span>
<a name="l00567"></a>00567         output += <span class="stringliteral">"&gt;\n"</span>;
<a name="l00568"></a>00568       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;Name&gt;%s&lt;/Name&gt;\n"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str());
<a name="l00569"></a>00569 
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a> != 0)
<a name="l00571"></a>00571         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;MaxVersions&gt;%u&lt;/MaxVersions&gt;\n"</span>,
<a name="l00572"></a>00572                          cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a>);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574       <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a> != 0)
<a name="l00575"></a>00575         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;ttl&gt;%d&lt;/ttl&gt;\n"</span>, (<span class="keywordtype">int</span>)cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a>);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577       <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a>)
<a name="l00578"></a>00578         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;deleted&gt;true&lt;/deleted&gt;\n"</span>);
<a name="l00579"></a>00579       <span class="keywordflow">else</span>
<a name="l00580"></a>00580         output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"      &lt;deleted&gt;false&lt;/deleted&gt;\n"</span>);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582       output += <span class="stringliteral">"    &lt;/ColumnFamily&gt;\n"</span>;
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584     output += <span class="stringliteral">"  &lt;/AccessGroup&gt;\n"</span>;
<a name="l00585"></a>00585   }
<a name="l00586"></a>00586   output += <span class="stringliteral">"&lt;/Schema&gt;\n"</span>;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="class_hypertable_1_1_schema.html#5bb599ec0f13b884faca34661ec0c296">00589</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#5bb599ec0f13b884faca34661ec0c296">Schema::render_hql_create_table</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;table_name, <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;output) {
<a name="l00590"></a>00590   <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> ag_string;
<a name="l00591"></a>00591   <span class="keywordtype">bool</span> got_columns;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   output += <span class="stringliteral">"\n"</span>;
<a name="l00594"></a>00594   output += <span class="stringliteral">"CREATE TABLE "</span>;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a> != <span class="stringliteral">""</span>)
<a name="l00597"></a>00597     output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"COMPRESSOR=\"%s\" "</span>, <a class="code" href="class_hypertable_1_1_schema.html#dea131c7a0f7fca619f65ca325298c37">m_compressor</a>.c_str());
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   output += table_name + <span class="stringliteral">" (\n"</span>;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf, <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>) {
<a name="l00602"></a>00602     <span class="comment">// don't display deleted cfs</span>
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a>)
<a name="l00604"></a>00604       <span class="keywordflow">continue</span>;
<a name="l00605"></a>00605     <span class="comment">// check to see if column family name needs quotes around it</span>
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (hql_needs_quotes(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str()))
<a name="l00607"></a>00607       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"  '%s'"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str());
<a name="l00608"></a>00608     <span class="keywordflow">else</span>
<a name="l00609"></a>00609       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"  %s"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str());
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a> != 0)
<a name="l00612"></a>00612       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" MAX_VERSIONS=%u"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cd48ee0c45da9a3658da60e366616c4f">max_versions</a>);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a> != 0)
<a name="l00615"></a>00615       output += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" TTL=%d"</span>, (<span class="keywordtype">int</span>)cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#dfd2949429fa30dcd1ac82d314078422">ttl</a>);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     output += <span class="stringliteral">",\n"</span>;
<a name="l00618"></a>00618   }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="keywordtype">size_t</span> i = 1;
<a name="l00621"></a>00621   <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *ag, <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>) {
<a name="l00622"></a>00622     got_columns = <span class="keyword">false</span>;
<a name="l00623"></a>00623     ag_string = <span class="stringliteral">"  ACCESS GROUP "</span>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (hql_needs_quotes(ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>.c_str()))
<a name="l00626"></a>00626       ag_string += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"'%s'"</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>.c_str());
<a name="l00627"></a>00627     <span class="keywordflow">else</span>
<a name="l00628"></a>00628       ag_string += ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f00c75922a651bcdd0a3be32e6c22f9c">in_memory</a>)
<a name="l00631"></a>00631       ag_string += <span class="stringliteral">" IN_MEMORY"</span>;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a> != 0)
<a name="l00634"></a>00634       ag_string += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" BLOCKSIZE=%u"</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#18987204f756e93815e614214cba8050">blocksize</a>);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a> != <span class="stringliteral">""</span>)
<a name="l00637"></a>00637       ag_string += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" COMPRESSOR=\"%s\""</span>, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#1c74b9ff41bfe0e05cf616533ee4b996">compressor</a>.c_str());
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">if</span> (ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a> != <span class="stringliteral">""</span>)
<a name="l00640"></a>00640       ag_string += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">" BLOOMFILTER=\"%s\""</span>,
<a name="l00641"></a>00641           ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#2183a4f9a3199b13416375df5fb30829">bloom_filter</a>.c_str());
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (!ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>.empty()) {
<a name="l00644"></a>00644       <span class="keywordtype">bool</span> display_comma = <span class="keyword">false</span>;
<a name="l00645"></a>00645       ag_string += <span class="stringliteral">" ("</span>;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647       <span class="keywordflow">foreach</span>(<span class="keyword">const</span> <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf, ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#7743b31ad829efff54c93d3df3578481">columns</a>) {
<a name="l00648"></a>00648         <span class="keywordflow">if</span> (cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a>)
<a name="l00649"></a>00649           <span class="keywordflow">continue</span>;
<a name="l00650"></a>00650         got_columns = <span class="keyword">true</span>;
<a name="l00651"></a>00651         <span class="comment">// check to see if column family name needs quotes around it</span>
<a name="l00652"></a>00652         <span class="keywordflow">if</span> (display_comma)
<a name="l00653"></a>00653           ag_string += <span class="stringliteral">", "</span>;
<a name="l00654"></a>00654         <span class="keywordflow">else</span>
<a name="l00655"></a>00655           display_comma = <span class="keyword">true</span>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="keywordflow">if</span> (hql_needs_quotes(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str()))
<a name="l00658"></a>00658           ag_string += <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"'%s'"</span>, cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str());
<a name="l00659"></a>00659         <span class="keywordflow">else</span>
<a name="l00660"></a>00660           ag_string += cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>;
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662       ag_string += <span class="stringliteral">")"</span>;
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     ag_string += i == <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>.size() ? <span class="stringliteral">"\n"</span> : <span class="stringliteral">",\n"</span>;
<a name="l00665"></a>00665     i++;
<a name="l00666"></a>00666     <span class="keywordflow">if</span> (got_columns)
<a name="l00667"></a>00667       output += ag_string;
<a name="l00668"></a>00668   }
<a name="l00669"></a>00669   output += <span class="stringliteral">")\n"</span>;
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 
<a name="l00677"></a><a class="code" href="class_hypertable_1_1_schema.html#83436b0f8fb8147c7b11f26a67f6655f">00677</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#83436b0f8fb8147c7b11f26a67f6655f" title="Protected methods.">Schema::is_valid</a>() {
<a name="l00678"></a>00678   <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_schema.html#70aab413af15f3e2370a31437487d0be">get_error_string</a>() != 0)
<a name="l00679"></a>00679     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00680"></a>00680   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00686"></a><a class="code" href="class_hypertable_1_1_schema.html#5e36d56aef59e6d96e6d8839fafe7e6c">00686</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#5e36d56aef59e6d96e6d8839fafe7e6c">Schema::set_generation</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *generation) {
<a name="l00687"></a>00687   <span class="keywordtype">int</span> gen_num = atoi(generation);
<a name="l00688"></a>00688   <span class="keywordflow">if</span> (gen_num &lt;= 0)
<a name="l00689"></a>00689     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid Table 'generation' value ("</span> + generation
<a name="l00690"></a>00690                       + <span class="stringliteral">")"</span>);
<a name="l00691"></a>00691   <a class="code" href="class_hypertable_1_1_schema.html#592e8ba1b6b5ef10ece219901b103d1f">m_generation</a> = gen_num;
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00697"></a><a class="code" href="class_hypertable_1_1_schema.html#cb63204642950414789af08cc6d22e97">00697</a> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_schema.html#cb63204642950414789af08cc6d22e97">Schema::set_max_column_family_id</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespace_hypertable_1_1_property.html#894a9e1b9934940df29ed0849e4be092">str</a>) {
<a name="l00698"></a>00698   <span class="keywordtype">int</span> gen_num = atoi(str);
<a name="l00699"></a>00699   <span class="keywordflow">if</span> (gen_num &lt;= 0)
<a name="l00700"></a>00700     <a class="code" href="class_hypertable_1_1_schema.html#5d2c96bbdf74a58ec86157c520e09718">set_error_string</a>((<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>)<span class="stringliteral">"Invalid Table 'max_column_family_id' value ("</span>
<a name="l00701"></a>00701         + str + <span class="stringliteral">")"</span>);
<a name="l00702"></a>00702   <a class="code" href="class_hypertable_1_1_schema.html#5e4b7eb9fa07105caeab62b44bc918e0">m_max_column_family_id</a> = (size_t) gen_num;
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a><a class="code" href="class_hypertable_1_1_schema.html#1665e6c2a05731badb7bfc5596c0343c">00705</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#1665e6c2a05731badb7bfc5596c0343c">Schema::add_access_group</a>(<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html">AccessGroup</a> *ag) {
<a name="l00706"></a>00706   pair&lt;AccessGroupMap::iterator, bool&gt; res =
<a name="l00707"></a>00707       <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.insert(make_pair(ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a>, ag));
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <span class="keywordflow">if</span> (!res.second) {
<a name="l00710"></a>00710     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>(<span class="stringliteral">"Access group '"</span>) + ag-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_access_group.html#f73dc29e25d8ce7ca2b67c15a3ced902">name</a> + <span class="stringliteral">"' multiply defined"</span>;
<a name="l00711"></a>00711     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00712"></a>00712   }
<a name="l00713"></a>00713   <a class="code" href="class_hypertable_1_1_schema.html#6c6c15410961bfd51191270a20ba84fd">m_access_groups</a>.push_back(ag);
<a name="l00714"></a>00714   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="class_hypertable_1_1_schema.html#07177ba9890d9a4f84549428ceb8e093">00717</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#07177ba9890d9a4f84549428ceb8e093">Schema::add_column_family</a>(<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf) {
<a name="l00718"></a>00718   pair&lt;ColumnFamilyMap::iterator, bool&gt; res =
<a name="l00719"></a>00719       <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.insert(make_pair(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>, cf));
<a name="l00720"></a>00720 
<a name="l00721"></a>00721   <span class="comment">// For now you can't drop and add the same column</span>
<a name="l00722"></a>00722   <span class="keywordflow">if</span> (!res.second) {
<a name="l00723"></a>00723     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"Column family '%s' multiply defined"</span>,
<a name="l00724"></a>00724                             cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>.c_str());
<a name="l00725"></a>00725     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00726"></a>00726   }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   AccessGroupMap::const_iterator ag_iter = <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.find(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a>);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <span class="keywordflow">if</span> (ag_iter == <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.end()) {
<a name="l00731"></a>00731     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>(<span class="stringliteral">"Invalid access group '"</span>) + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a>
<a name="l00732"></a>00732         + <span class="stringliteral">"' for column family '"</span> + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> + <span class="stringliteral">"'"</span>;
<a name="l00733"></a>00733     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.push_back(cf);
<a name="l00737"></a>00737   ag_iter-&gt;second-&gt;columns.push_back(cf);
<a name="l00738"></a>00738   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a><a class="code" href="class_hypertable_1_1_schema.html#b8ba1bf58cdf61769cb60182ee4efdb4">00741</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#b8ba1bf58cdf61769cb60182ee4efdb4">Schema::column_family_exists</a>(uint32_t <span class="keywordtype">id</span>, <span class="keywordtype">bool</span> get_deleted)<span class="keyword"> const</span>
<a name="l00742"></a>00742 <span class="keyword"></span>{
<a name="l00743"></a>00743   ColumnFamilyIdMap::const_iterator cf_iter = <a class="code" href="class_hypertable_1_1_schema.html#c91f0409cf79c95cac93f79ac070329b">m_column_family_id_map</a>.find(<span class="keywordtype">id</span>);
<a name="l00744"></a>00744   <span class="keywordflow">if</span> (cf_iter != <a class="code" href="class_hypertable_1_1_schema.html#c91f0409cf79c95cac93f79ac070329b">m_column_family_id_map</a>.end()) {
<a name="l00745"></a>00745     <span class="keywordflow">if</span> (get_deleted || cf_iter-&gt;second-&gt;deleted==<span class="keyword">false</span>)
<a name="l00746"></a>00746       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a><a class="code" href="class_hypertable_1_1_schema.html#27acad3e94aeceead295d04e26d7fdb8">00751</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#27acad3e94aeceead295d04e26d7fdb8">Schema::access_group_exists</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name)<span class="keyword"> const</span>
<a name="l00752"></a>00752 <span class="keyword"></span>{
<a name="l00753"></a>00753   AccessGroupMap::const_iterator ag_iter = <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.find(name);
<a name="l00754"></a>00754   <span class="keywordflow">return</span> (ag_iter != <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.end());
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 
<a name="l00758"></a><a class="code" href="class_hypertable_1_1_schema.html#7352d80ba3a7063f0e5896d96199facf">00758</a> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_schema.html#7352d80ba3a7063f0e5896d96199facf">Schema::drop_column_family</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name) {
<a name="l00759"></a>00759   <a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html">ColumnFamily</a> *cf;
<a name="l00760"></a>00760   uint32_t cf_id;
<a name="l00761"></a>00761   ColumnFamilyMap::iterator cf_map_it = <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.find(name);
<a name="l00762"></a>00762   ColumnFamilies::iterator cfs_it;
<a name="l00763"></a>00763   ColumnFamilies::iterator ag_cfs_it;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="keywordflow">if</span> (cf_map_it == <a class="code" href="class_hypertable_1_1_schema.html#d77ee5c9da2e4ed59988bcecc57a00da">m_column_family_map</a>.end()) {
<a name="l00766"></a>00766     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#baf99b188906f473b0ff1c3eaef925b4" title="Return a String using printf like format facilities vanilla snprintf is about 1.5x...">format</a>(<span class="stringliteral">"Column family '%s' not defined"</span>,
<a name="l00767"></a>00767                             name.c_str());
<a name="l00768"></a>00768     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00769"></a>00769   }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771   cf = cf_map_it-&gt;second;
<a name="l00772"></a>00772   cf_id = cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b475a258fe229c47090ef433ab98756f">id</a>;
<a name="l00773"></a>00773   AccessGroupMap::const_iterator ag_it = <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.find(cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a>);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="keywordflow">if</span> (ag_it == <a class="code" href="class_hypertable_1_1_schema.html#6f9a3c3bc7b9d75d5af454ab5e5d0405">m_access_group_map</a>.end()) {
<a name="l00776"></a>00776     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>(<span class="stringliteral">"Invalid access group '"</span>) + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a>
<a name="l00777"></a>00777         + <span class="stringliteral">"' for column family '"</span> + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a> + <span class="stringliteral">"'"</span>;
<a name="l00778"></a>00778     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00779"></a>00779   }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781   ag_cfs_it = find(ag_it-&gt;second-&gt;columns.begin(),
<a name="l00782"></a>00782       ag_it-&gt;second-&gt;columns.end(), cf);
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="keywordflow">if</span> (ag_cfs_it == ag_it-&gt;second-&gt;columns.end()) {
<a name="l00785"></a>00785     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>(<span class="stringliteral">"Column family '"</span>) + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>
<a name="l00786"></a>00786         + <span class="stringliteral">"' not found in access group '"</span> + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#cfc4e253ca8590c5abee81172d9b705a">ag</a> + <span class="stringliteral">"'"</span>;
<a name="l00787"></a>00787     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00788"></a>00788   }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   cfs_it = find(<a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.begin(),
<a name="l00791"></a>00791       <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.end(), cf);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793   <span class="keywordflow">if</span> (cfs_it == <a class="code" href="class_hypertable_1_1_schema.html#34cf43067d475734f03662724a69d7f4">m_column_families</a>.end()) {
<a name="l00794"></a>00794     <a class="code" href="class_hypertable_1_1_schema.html#7966315ad6ff659971afe05a8f5b08e0">m_error_string</a> = <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a>(<span class="stringliteral">"Column family '"</span>) + cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#b9d8e97ac1b6a3f5ee71e24ee85a9752">name</a>
<a name="l00795"></a>00795         + <span class="stringliteral">"' not found in Schema list of columns"</span>;
<a name="l00796"></a>00796     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00797"></a>00797   }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   cf-&gt;<a class="code" href="struct_hypertable_1_1_schema_1_1_column_family.html#ed3bc44a5a7b3d3ffd790679b7065c36">deleted</a> = <span class="keyword">true</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00802"></a>00802 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Aug 15 08:52:19 2009 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
