<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: Hypertable::DispatchHandlerSynchronizer Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="namespace_hypertable.html">Hypertable</a>::<a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html">DispatchHandlerSynchronizer</a></div>
<h1>Hypertable::DispatchHandlerSynchronizer Class Reference</h1><!-- doxytag: class="Hypertable::DispatchHandlerSynchronizer" --><!-- doxytag: inherits="Hypertable::DispatchHandler" -->This class is a <a class="el" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> class that can be used by a client to synchronize with response messages resulting from previously sent request messages.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for Hypertable::DispatchHandlerSynchronizer:</div>
<div class="dynsection">
<p><center><img src="class_hypertable_1_1_dispatch_handler_synchronizer__inherit__graph.png" border="0" usemap="#_hypertable_1_1_dispatch_handler_synchronizer__inherit__map" alt="Inheritance graph"></center>
<map name="_hypertable_1_1_dispatch_handler_synchronizer__inherit__map">
<area shape="rect" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer." alt="" coords="45,80,240,107"><area shape="rect" href="class_hypertable_1_1_reference_count.html" title="This class is meant to be a base class for all classes that want to be referenced..." alt="" coords="47,6,239,32"></map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center></div>
<div class="dynheader">
Collaboration diagram for Hypertable::DispatchHandlerSynchronizer:</div>
<div class="dynsection">
<p><center><img src="class_hypertable_1_1_dispatch_handler_synchronizer__coll__graph.png" border="0" usemap="#_hypertable_1_1_dispatch_handler_synchronizer__coll__map" alt="Collaboration graph"></center>
<map name="_hypertable_1_1_dispatch_handler_synchronizer__coll__map">
<area shape="rect" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer." alt="" coords="45,174,240,200"><area shape="rect" href="class_hypertable_1_1_reference_count.html" title="This class is meant to be a base class for all classes that want to be referenced..." alt="" coords="47,96,239,123"><area shape="rect" href="structatomic__t.html" title="atomic_t" alt="" coords="107,6,179,32"></map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="class_hypertable_1_1_dispatch_handler_synchronizer-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#be9be3679d4e32c74ee663ca4b913b9e">DispatchHandlerSynchronizer</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#be9be3679d4e32c74ee663ca4b913b9e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#ba6bdaf296666c775dad16840931ea41">~DispatchHandlerSynchronizer</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#d45ffb95c51184e64835d8b6c9106898">handle</a> (<a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> &amp;eventPtr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dispatch method.  <a href="#d45ffb95c51184e64835d8b6c9106898"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#7cdb249ea7881220186dd32020ca2a25">wait_for_reply</a> (<a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> &amp;eventPtr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This method is used by a client to synchronize.  <a href="#7cdb249ea7881220186dd32020ca2a25"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#a1fb8537556b7ba5a8bdc4d0ab1bd96b">m_valid</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::queue&lt; <a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#b9da248ffb803edb94f41b4a186ab1b6">m_receive_queue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">boost::mutex&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#08b2d28c405a97c62599cf361ff85ec6">m_mutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">boost::condition&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#62e950394a38b7f418581be86ddcd6e6">m_cond</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This class is a <a class="el" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> class that can be used by a client to synchronize with response messages resulting from previously sent request messages. 
<p>
It contains a queue of events (response events) and a condition variable that gets signalled when an event gets put on the queue.<p>
Example usage:<p>
<pre>
 {
   <a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> syncHandler;
   EventPtr eventPtr;
   CommBufPtr cbufPtr( ... create protocol message here ...  );
   if ((error = m_comm-&gt;send_request(m_addr, cbufPtr, &amp;syncHandler)) != <a class="el" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a>) {
      // log error message here ...
      return error;
   }
   if (!syncHandler.wait_for_reply(eventPtr))
       // log error message here ...
   error = (int)Protocol::response_code(eventPtr);
   return error;
 } </pre> 
<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00060">60</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="be9be3679d4e32c74ee663ca4b913b9e"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::DispatchHandlerSynchronizer" ref="be9be3679d4e32c74ee663ca4b913b9e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DispatchHandlerSynchronizer::DispatchHandlerSynchronizer           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor. 
<p>
Initializes state. 
<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html#l00034">34</a> of file <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html">DispatchHandlerSynchronizer.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="ba6bdaf296666c775dad16840931ea41"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::~DispatchHandlerSynchronizer" ref="ba6bdaf296666c775dad16840931ea41" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual Hypertable::DispatchHandlerSynchronizer::~DispatchHandlerSynchronizer           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00068">68</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d45ffb95c51184e64835d8b6c9106898"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::handle" ref="d45ffb95c51184e64835d8b6c9106898" args="(EventPtr &amp;eventPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DispatchHandlerSynchronizer::handle           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>eventPtr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Dispatch method. 
<p>
This gets called by the AsyncComm layer when an event occurs in response to a previously sent request that was supplied with this dispatch handler. It pushes the event onto the event queue and signals (notify_one) the condition variable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>eventPtr</em>&nbsp;</td><td>shared pointer to event object </td></tr>
  </table>
</dl>

<p>Implements <a class="el" href="class_hypertable_1_1_dispatch_handler.html#d8c7975d126c64104e48c26b03034b18">Hypertable::DispatchHandler</a>.</p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html#l00043">43</a> of file <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html">DispatchHandlerSynchronizer.cc</a>.</p>

</div>
</div><p>
<a class="anchor" name="7cdb249ea7881220186dd32020ca2a25"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::wait_for_reply" ref="7cdb249ea7881220186dd32020ca2a25" args="(EventPtr &amp;eventPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool DispatchHandlerSynchronizer::wait_for_reply           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>eventPtr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This method is used by a client to synchronize. 
<p>
The client sends a request via the AsyncComm layer with this object as the dispatch handler. It then calls this method to wait for the response (or timeout event). This method just blocks on the condition variable until the event queue is non-empty and then pops and returns the head of the queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>eventPtr</em>&nbsp;</td><td>shared pointer to event object </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if next returned event is type MESSAGE and contains status <a class="el" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a>, false otherwise </dd></dl>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html#l00055">55</a> of file <a class="el" href="_dispatch_handler_synchronizer_8cc-source.html">DispatchHandlerSynchronizer.cc</a>.</p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="a1fb8537556b7ba5a8bdc4d0ab1bd96b"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::m_valid" ref="a1fb8537556b7ba5a8bdc4d0ab1bd96b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#a1fb8537556b7ba5a8bdc4d0ab1bd96b">Hypertable::DispatchHandlerSynchronizer::m_valid</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00098">98</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="b9da248ffb803edb94f41b4a186ab1b6"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::m_receive_queue" ref="b9da248ffb803edb94f41b4a186ab1b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::queue&lt;<a class="el" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a>&gt; <a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#b9da248ffb803edb94f41b4a186ab1b6">Hypertable::DispatchHandlerSynchronizer::m_receive_queue</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00099">99</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="08b2d28c405a97c62599cf361ff85ec6"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::m_mutex" ref="08b2d28c405a97c62599cf361ff85ec6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex <a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#08b2d28c405a97c62599cf361ff85ec6">Hypertable::DispatchHandlerSynchronizer::m_mutex</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00100">100</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="62e950394a38b7f418581be86ddcd6e6"></a><!-- doxytag: member="Hypertable::DispatchHandlerSynchronizer::m_cond" ref="62e950394a38b7f418581be86ddcd6e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::condition <a class="el" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#62e950394a38b7f418581be86ddcd6e6">Hypertable::DispatchHandlerSynchronizer::m_cond</a><code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_dispatch_handler_synchronizer_8h-source.html#l00101">101</a> of file <a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>/Users/doug/src/hypertable/src/cc/AsyncComm/<a class="el" href="_dispatch_handler_synchronizer_8h-source.html">DispatchHandlerSynchronizer.h</a><li>/Users/doug/src/hypertable/src/cc/AsyncComm/<a class="el" href="_dispatch_handler_synchronizer_8cc-source.html">DispatchHandlerSynchronizer.cc</a></ul>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri May 23 14:50:57 2008 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
