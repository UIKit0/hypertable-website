<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: /Users/doug/src/hypertable/src/cc/DfsBroker/Lib/Client.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5708de38a757cb70589c505d18009990.html">doug</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a5f6cd2e2a2b5320bbe75e5c719f1fee.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_752ad1e2f45ee7988941467b4eccee0e.html">hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9031e3d7c38caf639b0143600d70b482.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5aae9766518c5969fd00e3382787720.html">cc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c3c604fdad199344478df8227f4c80be.html">DfsBroker</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_df8487a01cb755e77d7c6a87e00c90c2.html">Lib</a>
  </div>
</div>
<div class="contents">
<h1>Client.cc</h1><a href="_dfs_broker_2_lib_2_client_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_compat_8h.html">Common/Compat.h</a>"</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="_error_8h.html">Common/Error.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="_logger_8h.html">Common/Logger.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_serialization_8h.html">Common/Serialization.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_comm_8h.html">AsyncComm/Comm.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_comm_header_8h.html">AsyncComm/CommHeader.h</a>"</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="_dfs_broker_2_lib_2_client_8h.html">Client.h</a>"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">using namespace </span>Hypertable;
<a name="l00035"></a>00035 <span class="keyword">using namespace </span>Serialization;
<a name="l00036"></a>00036 <span class="keyword">using namespace </span>Hypertable::DfsBroker;
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#251c15223f63ad0818161165440ffe2d">00038</a> Client::Client(<a class="code" href="namespace_hypertable.html#e048a08bc9bd9505788d6e5823c948ae">ConnectionManagerPtr</a> &amp;conn_mgr, <span class="keyword">const</span> sockaddr_in &amp;addr,
<a name="l00039"></a>00039                uint32_t timeout_ms)
<a name="l00040"></a>00040     : m_conn_mgr(conn_mgr), m_addr(addr), m_timeout_ms(timeout_ms) {
<a name="l00041"></a>00041   <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e23b8dd22571bf11530123c48e2f8e84">m_comm</a> = conn_mgr-&gt;get_comm();
<a name="l00042"></a>00042   conn_mgr-&gt;add(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e4ab0092e00b8a88d17fbfae1ecc133a">m_timeout_ms</a>, <span class="stringliteral">"DFS Broker"</span>);
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#fa8bf26de71c79ab6f150e6571a057e4">00046</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#251c15223f63ad0818161165440ffe2d" title="Constructor with explicit values.">Client::Client</a>(<a class="code" href="namespace_hypertable.html#e048a08bc9bd9505788d6e5823c948ae">ConnectionManagerPtr</a> &amp;conn_mgr, <a class="code" href="namespace_hypertable.html#3c17fee96d466b253b38bf89565838ff">PropertiesPtr</a> &amp;cfg)
<a name="l00047"></a>00047     : m_conn_mgr(conn_mgr) {
<a name="l00048"></a>00048   <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e23b8dd22571bf11530123c48e2f8e84">m_comm</a> = conn_mgr-&gt;get_comm();
<a name="l00049"></a>00049   uint16_t port = cfg-&gt;get_i16(<span class="stringliteral">"DfsBroker.Port"</span>);
<a name="l00050"></a>00050   <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> host = cfg-&gt;get_str(<span class="stringliteral">"DfsBroker.Host"</span>);
<a name="l00051"></a>00051   <span class="keywordflow">if</span> (cfg-&gt;has(<span class="stringliteral">"DfsBroker.Timeout"</span>))
<a name="l00052"></a>00052     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e4ab0092e00b8a88d17fbfae1ecc133a">m_timeout_ms</a> = cfg-&gt;get_i32(<span class="stringliteral">"DfsBroker.Timeout"</span>);
<a name="l00053"></a>00053   <span class="keywordflow">else</span>
<a name="l00054"></a>00054     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e4ab0092e00b8a88d17fbfae1ecc133a">m_timeout_ms</a> = cfg-&gt;get_i32(<span class="stringliteral">"Hypertable.Request.Timeout"</span>);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   <a class="code" href="namespace_hypertable_1_1_logger.html#53e39dccd8c7ead3805b1a4c95850619">InetAddr::initialize</a>(&amp;<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, host.c_str(), port);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   conn_mgr-&gt;add(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e4ab0092e00b8a88d17fbfae1ecc133a">m_timeout_ms</a>, <span class="stringliteral">"DFS Broker"</span>);
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5f7f9e33431ae644719b51ea94180cb4">00061</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#251c15223f63ad0818161165440ffe2d" title="Constructor with explicit values.">Client::Client</a>(<a class="code" href="class_hypertable_1_1_comm.html" title="Provides communication (message passing) services to an application.">Comm</a> *comm, <span class="keyword">const</span> sockaddr_in &amp;addr, uint32_t timeout_ms)
<a name="l00062"></a>00062     : m_comm(comm), m_conn_mgr(0), m_addr(addr), m_timeout_ms(timeout_ms) {
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#7f16c21691de0f9ef43b07d6ec568bad">00065</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#251c15223f63ad0818161165440ffe2d" title="Constructor with explicit values.">Client::Client</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;host, <span class="keywordtype">int</span> port, uint32_t timeout_ms)
<a name="l00066"></a>00066     : m_timeout_ms(timeout_ms) {
<a name="l00067"></a>00067   <a class="code" href="namespace_hypertable_1_1_logger.html#53e39dccd8c7ead3805b1a4c95850619">InetAddr::initialize</a>(&amp;<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, host.c_str(), port);
<a name="l00068"></a>00068   <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e23b8dd22571bf11530123c48e2f8e84">m_comm</a> = <a class="code" href="class_hypertable_1_1_comm.html#193565c5dddb894233ad534e5f11b8f7">Comm::instance</a>();
<a name="l00069"></a>00069   <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ad5abd07f4c63717c0e0e1c65536116f">m_conn_mgr</a> = <span class="keyword">new</span> <a class="code" href="class_hypertable_1_1_connection_manager.html" title="Establishes and maintains a set of TCP connections.">ConnectionManager</a>(m_comm);
<a name="l00070"></a>00070   <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ad5abd07f4c63717c0e0e1c65536116f">m_conn_mgr</a>-&gt;add(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, timeout_ms, <span class="stringliteral">"DFS Broker"</span>);
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="keywordtype">void</span>
<a name="l00074"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#f6e475c78b50de46a9461065ce5e4098">00074</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#f6e475c78b50de46a9461065ce5e4098" title="Opens a file asynchronously.">Client::open</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00075"></a>00075   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#fea7e718a9053fe0eba4b9043e739156">create_open_request</a>(name, 0));
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <span class="keywordflow">try</span> {
<a name="l00078"></a>00078     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler);
<a name="l00079"></a>00079   }
<a name="l00080"></a>00080   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00081"></a>00081     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error opening DFS file: %s"</span>, name.c_str());
<a name="l00082"></a>00082   }
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keywordtype">int</span>
<a name="l00087"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#aada9049ea0545c215a23477f87398ac">00087</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#f6e475c78b50de46a9461065ce5e4098" title="Opens a file asynchronously.">Client::open</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name) {
<a name="l00088"></a>00088   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00089"></a>00089   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00090"></a>00090   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#fea7e718a9053fe0eba4b9043e739156">create_open_request</a>(name, 0));
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   <span class="keywordflow">try</span> {
<a name="l00093"></a>00093     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00096"></a>00096       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00097"></a>00097                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#b6d0488b8f63726709ac9cc7b721547e" title="Decodes the response from an open request.">decode_response_open</a>(event_ptr);
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00102"></a>00102     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error opening DFS file: %s"</span>, name.c_str());
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">int</span>
<a name="l00108"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ac117af0bde413dbf34ab4c64730c782">00108</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ac117af0bde413dbf34ab4c64730c782" title="Opens a file in buffered (readahead) mode.">Client::open_buffered</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, uint32_t buf_size,
<a name="l00109"></a>00109                       uint32_t outstanding, uint64_t start_offset,
<a name="l00110"></a>00110                       uint64_t end_offset) {
<a name="l00111"></a>00111   <span class="keywordflow">try</span> {
<a name="l00112"></a>00112     <span class="keywordtype">int</span> fd = <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#f6e475c78b50de46a9461065ce5e4098" title="Opens a file asynchronously.">open</a>(name);
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#92dfd6259b3b74a2b18b5e8acbe3d565">m_mutex</a>);
<a name="l00115"></a>00115       <a class="code" href="_logger_8h.html#cf985e8f1a1bebe7d622115e4b3e08a6">HT_ASSERT</a>(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.find(fd) == <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.end());
<a name="l00116"></a>00116       <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>[fd] =
<a name="l00117"></a>00117           <span class="keyword">new</span> <a class="code" href="class_hypertable_1_1_client_buffered_reader_handler.html">ClientBufferedReaderHandler</a>(<span class="keyword">this</span>, fd, buf_size, outstanding,
<a name="l00118"></a>00118                                           start_offset, end_offset);
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">return</span> fd;
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00123"></a>00123     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error opening buffered DFS file=%s buf_size=%u "</span>
<a name="l00124"></a>00124         <span class="stringliteral">"outstanding=%u start_offset=%llu end_offset=%llu"</span>, name.c_str(),
<a name="l00125"></a>00125         buf_size, outstanding, (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)start_offset, (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)end_offset);
<a name="l00126"></a>00126   }
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="keywordtype">void</span>
<a name="l00131"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#3adef0f381e2bcc305a56c8afc6d18a2">00131</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#3adef0f381e2bcc305a56c8afc6d18a2" title="Creates a file asynchronously.">Client::create</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <span class="keywordtype">bool</span> overwrite, int32_t bufsz,
<a name="l00132"></a>00132                int32_t replication, int64_t blksz,
<a name="l00133"></a>00133                <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00134"></a>00134   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#161c27764e4c936ffc45b44b7014d76e">create_create_request</a>(name, overwrite,
<a name="l00135"></a>00135                      bufsz, replication, blksz));
<a name="l00136"></a>00136   <span class="keywordflow">try</span> {
<a name="l00137"></a>00137     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler);
<a name="l00138"></a>00138   }
<a name="l00139"></a>00139   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00140"></a>00140     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error creating DFS file: %s:"</span>, name.c_str());
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="keywordtype">int</span>
<a name="l00146"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#61f5acae6c5510e1fca00467f6a61580">00146</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#3adef0f381e2bcc305a56c8afc6d18a2" title="Creates a file asynchronously.">Client::create</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <span class="keywordtype">bool</span> overwrite, int32_t bufsz,
<a name="l00147"></a>00147                int32_t replication, int64_t blksz) {
<a name="l00148"></a>00148   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00149"></a>00149   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00150"></a>00150   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#161c27764e4c936ffc45b44b7014d76e">create_create_request</a>(name, overwrite,
<a name="l00151"></a>00151                      bufsz, replication, blksz));
<a name="l00152"></a>00152   <span class="keywordflow">try</span> {
<a name="l00153"></a>00153     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00156"></a>00156       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00157"></a>00157                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#d0f3cdd22e482e514c1b492ec5ac8854" title="Decodes the response from a create request.">decode_response_create</a>(event_ptr);
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00162"></a>00162     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error creating DFS file: %s"</span>, name.c_str());
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="keywordtype">void</span>
<a name="l00168"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#971ea00bb36de37614a81d4c949c90e6">00168</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#971ea00bb36de37614a81d4c949c90e6">Client::close</a>(int32_t fd, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00169"></a>00169   <a class="code" href="class_hypertable_1_1_client_buffered_reader_handler.html">ClientBufferedReaderHandler</a> *reader_handler = 0;
<a name="l00170"></a>00170   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#9630b3f2199129364b00f0ed6e705cd6">create_close_request</a>(fd));
<a name="l00171"></a>00171   {
<a name="l00172"></a>00172     <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#92dfd6259b3b74a2b18b5e8acbe3d565">m_mutex</a>);
<a name="l00173"></a>00173     BufferedReaderMap::iterator iter = <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.find(fd);
<a name="l00174"></a>00174     <span class="keywordflow">if</span> (iter != <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.end()) {
<a name="l00175"></a>00175       reader_handler = (*iter).second;
<a name="l00176"></a>00176       <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.erase(iter);
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178   }
<a name="l00179"></a>00179   <span class="keyword">delete</span> reader_handler;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">try</span> {
<a name="l00182"></a>00182     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler);
<a name="l00183"></a>00183   }
<a name="l00184"></a>00184   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00185"></a>00185     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error closing DFS fd: %d"</span>, (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)fd);
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="keywordtype">void</span>
<a name="l00191"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#bd8e536745649e82761189efe261b6de">00191</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#971ea00bb36de37614a81d4c949c90e6">Client::close</a>(int32_t fd) {
<a name="l00192"></a>00192   <a class="code" href="class_hypertable_1_1_client_buffered_reader_handler.html">ClientBufferedReaderHandler</a> *reader_handler = 0;
<a name="l00193"></a>00193   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00194"></a>00194   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00195"></a>00195   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#9630b3f2199129364b00f0ed6e705cd6">create_close_request</a>(fd));
<a name="l00196"></a>00196   {
<a name="l00197"></a>00197     <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#92dfd6259b3b74a2b18b5e8acbe3d565">m_mutex</a>);
<a name="l00198"></a>00198     BufferedReaderMap::iterator iter = <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.find(fd);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (iter != <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.end()) {
<a name="l00201"></a>00201       reader_handler = (*iter).second;
<a name="l00202"></a>00202       <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.erase(iter);
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   <span class="keyword">delete</span> reader_handler;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">try</span> {
<a name="l00208"></a>00208     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00211"></a>00211       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00212"></a>00212                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00213"></a>00213   }
<a name="l00214"></a>00214   <span class="keywordflow">catch</span>(<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00215"></a>00215     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error closing DFS fd: %d"</span>, (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)fd);
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keywordtype">void</span>
<a name="l00221"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b9a3c538419d7cbe62c27e1ae081d29e">00221</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b9a3c538419d7cbe62c27e1ae081d29e">Client::read</a>(int32_t fd, <span class="keywordtype">size_t</span> len, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00222"></a>00222   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#1f0f240c0232e1efea278d4c2cfce2ec">create_read_request</a>(fd, len));
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordflow">try</span> {
<a name="l00225"></a>00225     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler);
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00228"></a>00228     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending read request for %u bytes "</span>
<a name="l00229"></a>00229                <span class="stringliteral">"from DFS fd: %d"</span>, (unsigned)len, (<span class="keywordtype">int</span>)fd);
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="keywordtype">size_t</span>
<a name="l00235"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#be67059d0839aeb8ba2b3000132c3b76">00235</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b9a3c538419d7cbe62c27e1ae081d29e">Client::read</a>(int32_t fd, <span class="keywordtype">void</span> *<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>, <span class="keywordtype">size_t</span> len) {
<a name="l00236"></a>00236   <a class="code" href="class_hypertable_1_1_client_buffered_reader_handler.html">ClientBufferedReaderHandler</a> *reader_handler = 0;
<a name="l00237"></a>00237   {
<a name="l00238"></a>00238     <a class="code" href="namespace_hypertable.html#40784200dfed22d08fc5b7329dd1f663">ScopedLock</a> lock(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#92dfd6259b3b74a2b18b5e8acbe3d565">m_mutex</a>);
<a name="l00239"></a>00239     BufferedReaderMap::iterator iter = <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.find(fd);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (iter != <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8e744e59322d85ef7f62251d7744b511">m_buffered_reader_map</a>.end())
<a name="l00242"></a>00242       reader_handler = (*iter).second;
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244   <span class="keywordflow">try</span> {
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (reader_handler)
<a name="l00246"></a>00246       <span class="keywordflow">return</span> reader_handler-&gt;<a class="code" href="class_hypertable_1_1_client_buffered_reader_handler.html#95199d2b0a0749925cd38f5a5259dcec">read</a>(dst, len);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00249"></a>00249     <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00250"></a>00250     <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#1f0f240c0232e1efea278d4c2cfce2ec">create_read_request</a>(fd, len));
<a name="l00251"></a>00251     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00254"></a>00254       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00255"></a>00255                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#c812023a8c96b9a8c9386e28c4e787fd" title="Decodes the response from a read request.">decode_response_read</a>(event_ptr, dst, len);
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00260"></a>00260     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error reading %u bytes from DFS fd %d"</span>,
<a name="l00261"></a>00261                (unsigned)len, (<span class="keywordtype">int</span>)fd);
<a name="l00262"></a>00262   }
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="keywordtype">void</span>
<a name="l00267"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#a22b0b2343ad8512bc33fb6fff581c13">00267</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#a22b0b2343ad8512bc33fb6fff581c13">Client::append</a>(int32_t fd, <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> &amp;buffer, uint32_t flags,
<a name="l00268"></a>00268                <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00269"></a>00269   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#0f76c4d612a7d75866e5da4ce8879eb9">create_append_request</a>(fd, buffer, flags));
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00272"></a>00272   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00273"></a>00273     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error appending %u bytes to DFS fd %d"</span>,
<a name="l00274"></a>00274                (unsigned)buffer.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a>, (<span class="keywordtype">int</span>)fd);
<a name="l00275"></a>00275   }
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keywordtype">size_t</span>
<a name="l00280"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e27db2b378c625f26aee4fd3cfac6d35">00280</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#a22b0b2343ad8512bc33fb6fff581c13">Client::append</a>(int32_t fd, <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> &amp;buffer, uint32_t flags) {
<a name="l00281"></a>00281   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00282"></a>00282   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00283"></a>00283   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#0f76c4d612a7d75866e5da4ce8879eb9">create_append_request</a>(fd, buffer, flags));
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="keywordflow">try</span> {
<a name="l00286"></a>00286     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00289"></a>00289       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00290"></a>00290                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00291"></a>00291     uint64_t offset;
<a name="l00292"></a>00292     <span class="keywordtype">size_t</span> ret = <a class="code" href="class_hypertable_1_1_filesystem.html#104c68475b5e696e285cfbc813d5ac2a" title="Decodes the response from an append request.">decode_response_append</a>(event_ptr, &amp;offset);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (buffer.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a> != ret)
<a name="l00295"></a>00295       <a class="code" href="_error_8h.html#a274083bca13ee78497570285c908c80">HT_THROWF</a>(<a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b2c2e4e3925a09bbc1f394aabb8f75fd56">Error::DFSBROKER_IO_ERROR</a>, <span class="stringliteral">"tried to append %u bytes but got "</span>
<a name="l00296"></a>00296                 <span class="stringliteral">"%u"</span>, (<span class="keywordtype">unsigned</span>)buffer.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a>, (<span class="keywordtype">unsigned</span>)ret);
<a name="l00297"></a>00297     <span class="keywordflow">return</span> ret;
<a name="l00298"></a>00298   }
<a name="l00299"></a>00299   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00300"></a>00300     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error appending %u bytes to DFS fd %d"</span>,
<a name="l00301"></a>00301                (unsigned)buffer.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a>, (<span class="keywordtype">int</span>)fd);
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="keywordtype">void</span>
<a name="l00307"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#53aed357928115672dcb2ad73f87354a">00307</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#53aed357928115672dcb2ad73f87354a">Client::seek</a>(int32_t fd, uint64_t offset, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00308"></a>00308   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#91f2898c7305d0ee0b0b7da9a5b5b47d">create_seek_request</a>(fd, offset));
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00311"></a>00311   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00312"></a>00312     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error seeking to %llu on DFS fd %d"</span>,
<a name="l00313"></a>00313                (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)offset, (<span class="keywordtype">int</span>)fd);
<a name="l00314"></a>00314   }
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="keywordtype">void</span>
<a name="l00319"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#4fd32960a72d48225a0bb91106da0090">00319</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#53aed357928115672dcb2ad73f87354a">Client::seek</a>(int32_t fd, uint64_t offset) {
<a name="l00320"></a>00320   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00321"></a>00321   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00322"></a>00322   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#91f2898c7305d0ee0b0b7da9a5b5b47d">create_seek_request</a>(fd, offset));
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <span class="keywordflow">try</span> {
<a name="l00325"></a>00325     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00328"></a>00328       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00329"></a>00329                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00332"></a>00332     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error seeking to %llu on DFS fd %d"</span>,
<a name="l00333"></a>00333                (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)offset, (<span class="keywordtype">int</span>)fd);
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#29d365e6bfccb8890436a1fb7146cc83">00339</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#29d365e6bfccb8890436a1fb7146cc83" title="Removes a file asynchronously.">Client::remove</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00340"></a>00340   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ddb24b40415f4abcaf2aa1e4f2959ccc">create_remove_request</a>(name));
<a name="l00341"></a>00341 
<a name="l00342"></a>00342   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00343"></a>00343   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00344"></a>00344     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error removing DFS file: %s"</span>, name.c_str());
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <span class="keywordtype">void</span>
<a name="l00350"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#15c10400915a592bc69825f394a08929">00350</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#29d365e6bfccb8890436a1fb7146cc83" title="Removes a file asynchronously.">Client::remove</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <span class="keywordtype">bool</span> force) {
<a name="l00351"></a>00351   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00352"></a>00352   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00353"></a>00353   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ddb24b40415f4abcaf2aa1e4f2959ccc">create_remove_request</a>(name));
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="keywordflow">try</span> {
<a name="l00356"></a>00356     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr)) {
<a name="l00359"></a>00359       <span class="keywordtype">int</span> error = <a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get());
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <span class="keywordflow">if</span> (!force || error != <a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b2155fd69032d04ba2e191b6ba3b94fef6">Error::DFSBROKER_FILE_NOT_FOUND</a>)
<a name="l00362"></a>00362         <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(error, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00366"></a>00366     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error removing DFS file: %s"</span>, name.c_str());
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="keywordtype">void</span>
<a name="l00372"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#aca1d768a1eaa6e31699624d1830620f">00372</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#aca1d768a1eaa6e31699624d1830620f" title="Shuts down the DFS broker.">Client::shutdown</a>(uint16_t flags, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00373"></a>00373   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#36d246b08f0feef17d62a2a47241edaa">create_shutdown_request</a>(flags));
<a name="l00374"></a>00374 
<a name="l00375"></a>00375   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00376"></a>00376   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00377"></a>00377     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"sending DFS shutdown (flags=%d)"</span>, (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)flags);
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="keywordtype">void</span>
<a name="l00383"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#6ed8ce1e4bf9576c84e70532df3ed3e0">00383</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#6ed8ce1e4bf9576c84e70532df3ed3e0" title="Checks the status of the DFS broker.">Client::status</a>() {
<a name="l00384"></a>00384   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00385"></a>00385   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00386"></a>00386   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#232d7ac6d664c7b87a3ee2eff57bacf4">create_status_request</a>());
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   <span class="keywordflow">try</span> {
<a name="l00389"></a>00389     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00392"></a>00392       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00393"></a>00393                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordtype">int</span> error = <a class="code" href="class_hypertable_1_1_filesystem.html#0b0ee755c94adefc621803059283711a" title="Decodes the response from an request that only returns an error code.">decode_response</a>(event_ptr);
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (error != <a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a>)
<a name="l00397"></a>00397       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(error, <span class="stringliteral">""</span>);
<a name="l00398"></a>00398   }
<a name="l00399"></a>00399   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00400"></a>00400     <a class="code" href="_error_8h.html#b49551352d22486918141c548daffc80">HT_THROW2</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, e.what());
<a name="l00401"></a>00401   }
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="keywordtype">void</span>
<a name="l00406"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#08fcf770220c5316ed11f194b7885c97">00406</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#08fcf770220c5316ed11f194b7885c97" title="Gets the length of a file asynchronously.">Client::length</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00407"></a>00407   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#d007453b3fac55054704961a194694da">create_length_request</a>(name));
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00410"></a>00410   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00411"></a>00411     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending length request for DFS file: %s"</span>,
<a name="l00412"></a>00412                name.c_str());
<a name="l00413"></a>00413   }
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 int64_t
<a name="l00418"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#1bab745c6ee86d94fa51e63c5decd280">00418</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#08fcf770220c5316ed11f194b7885c97" title="Gets the length of a file asynchronously.">Client::length</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name) {
<a name="l00419"></a>00419   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00420"></a>00420   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00421"></a>00421   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#d007453b3fac55054704961a194694da">create_length_request</a>(name));
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="keywordflow">try</span> {
<a name="l00424"></a>00424     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00427"></a>00427       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00428"></a>00428                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#0763bc2633a3069b44a684a4242c3790" title="Decodes the response from a length request.">decode_response_length</a>(event_ptr);
<a name="l00431"></a>00431   }
<a name="l00432"></a>00432   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00433"></a>00433     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error getting length of DFS file: %s"</span>,
<a name="l00434"></a>00434                name.c_str());
<a name="l00435"></a>00435   }
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="keywordtype">void</span>
<a name="l00440"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ddd5147ce4a44926fae439e57040c9a4">00440</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ddd5147ce4a44926fae439e57040c9a4">Client::pread</a>(int32_t fd, <span class="keywordtype">size_t</span> len, uint64_t offset,
<a name="l00441"></a>00441               <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00442"></a>00442   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#17f29b17d9752387ec3d9dda95669f1d">create_position_read_request</a>(fd, offset, len));
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00445"></a>00445   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00446"></a>00446     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending pread request at byte %llu "</span>
<a name="l00447"></a>00447                <span class="stringliteral">"on DFS fd %d"</span>, (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)offset, (<span class="keywordtype">int</span>)fd);
<a name="l00448"></a>00448   }
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="keywordtype">size_t</span>
<a name="l00453"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#4f37f5e1652b52fcd5e5b8a3457bcb30">00453</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ddd5147ce4a44926fae439e57040c9a4">Client::pread</a>(int32_t fd, <span class="keywordtype">void</span> *<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>, <span class="keywordtype">size_t</span> len, uint64_t offset) {
<a name="l00454"></a>00454   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00455"></a>00455   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00456"></a>00456   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#17f29b17d9752387ec3d9dda95669f1d">create_position_read_request</a>(fd, offset, len));
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   <span class="keywordflow">try</span> {
<a name="l00459"></a>00459     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00462"></a>00462       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00463"></a>00463                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#80c047e605f8e232672febd2d2873a15" title="Decodes the response from a pread request.">decode_response_pread</a>(event_ptr, dst, len);
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00468"></a>00468     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error preading at byte %llu on DFS fd %d"</span>,
<a name="l00469"></a>00469                (<a class="code" href="namespace_hypertable.html#85c40099ee846f8b60b73c30c6ee2162">Llu</a>)offset, (<span class="keywordtype">int</span>)fd);
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="keywordtype">void</span>
<a name="l00475"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#952e2f8e844f58d12b4908669bc860cb">00475</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#952e2f8e844f58d12b4908669bc860cb" title="Creates a directory asynchronously.">Client::mkdirs</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00476"></a>00476   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#128c9aef06613716e7855f84f9195a5e">create_mkdirs_request</a>(name));
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00479"></a>00479   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00480"></a>00480     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending mkdirs request for DFS "</span>
<a name="l00481"></a>00481                <span class="stringliteral">"directory: %s"</span>, name.c_str());
<a name="l00482"></a>00482   }
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="keywordtype">void</span>
<a name="l00487"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d303be3f79759754cef3739e300de48f">00487</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#952e2f8e844f58d12b4908669bc860cb" title="Creates a directory asynchronously.">Client::mkdirs</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name) {
<a name="l00488"></a>00488   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00489"></a>00489   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00490"></a>00490   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#128c9aef06613716e7855f84f9195a5e">create_mkdirs_request</a>(name));
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="keywordflow">try</span> {
<a name="l00493"></a>00493     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00496"></a>00496       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00497"></a>00497                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00498"></a>00498   }
<a name="l00499"></a>00499   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00500"></a>00500     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error mkdirs DFS directory %s"</span>, name.c_str());
<a name="l00501"></a>00501   }
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="keywordtype">void</span>
<a name="l00506"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#1e4764e9f936f36709466d60f346c8aa">00506</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#1e4764e9f936f36709466d60f346c8aa">Client::flush</a>(int32_t fd, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00507"></a>00507   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#08edff87959ed0c04e54909af66ef728">create_flush_request</a>(fd));
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00510"></a>00510   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00511"></a>00511     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error flushing DFS fd %d"</span>, (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)fd);
<a name="l00512"></a>00512   }
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="keywordtype">void</span>
<a name="l00517"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#4a7b4deb0e604583df5fbd40e43dd421">00517</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#1e4764e9f936f36709466d60f346c8aa">Client::flush</a>(int32_t fd) {
<a name="l00518"></a>00518   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00519"></a>00519   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00520"></a>00520   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#08edff87959ed0c04e54909af66ef728">create_flush_request</a>(fd));
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   <span class="keywordflow">try</span> {
<a name="l00523"></a>00523     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00526"></a>00526       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00527"></a>00527                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00530"></a>00530     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error flushing DFS fd %d"</span>, (<a class="code" href="lzoconf_8h.html#b832c174e145540d491b0830fc05dbb1">int</a>)fd);
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="keywordtype">void</span>
<a name="l00536"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#cc100849eaa7950de085437eb1a15ee8">00536</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#cc100849eaa7950de085437eb1a15ee8" title="Recursively removes a directory asynchronously.">Client::rmdir</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00537"></a>00537   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#2b5fe6080d34073ad47237b7e318cf51">create_rmdir_request</a>(name));
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00540"></a>00540   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00541"></a>00541     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending rmdir request for DFS directory: "</span>
<a name="l00542"></a>00542                <span class="stringliteral">"%s"</span>, name.c_str());
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="keywordtype">void</span>
<a name="l00548"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#c11325ebea1aa512ead41e5ccda7891f">00548</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#cc100849eaa7950de085437eb1a15ee8" title="Recursively removes a directory asynchronously.">Client::rmdir</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <span class="keywordtype">bool</span> force) {
<a name="l00549"></a>00549   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00550"></a>00550   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00551"></a>00551   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#2b5fe6080d34073ad47237b7e318cf51">create_rmdir_request</a>(name));
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="keywordflow">try</span> {
<a name="l00554"></a>00554     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr)) {
<a name="l00557"></a>00557       <span class="keywordtype">int</span> error = <a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get());
<a name="l00558"></a>00558 
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (!force || error != <a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b2155fd69032d04ba2e191b6ba3b94fef6">Error::DFSBROKER_FILE_NOT_FOUND</a>)
<a name="l00560"></a>00560         <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(error, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562   }
<a name="l00563"></a>00563   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00564"></a>00564     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error removing DFS directory: %s"</span>, name.c_str());
<a name="l00565"></a>00565   }
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 
<a name="l00572"></a>00572 <span class="keywordtype">void</span>
<a name="l00573"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b0f27fa2e1b26f41086399ed891a6bd3">00573</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b0f27fa2e1b26f41086399ed891a6bd3" title="Obtains a listing of all files in a directory asynchronously.">Client::readdir</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00574"></a>00574   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ac44dea528550faf12da0bbdf362e59b">create_readdir_request</a>(name));
<a name="l00575"></a>00575 
<a name="l00576"></a>00576   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00577"></a>00577   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00578"></a>00578     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending readdir request for DFS directory"</span>
<a name="l00579"></a>00579                <span class="stringliteral">": %s"</span>, name.c_str());
<a name="l00580"></a>00580   }
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00587"></a>00587 <span class="keywordtype">void</span>
<a name="l00588"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#81883a4b1c91e3c7750f246eb04cf071">00588</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b0f27fa2e1b26f41086399ed891a6bd3" title="Obtains a listing of all files in a directory asynchronously.">Client::readdir</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, std::vector&lt;String&gt; &amp;listing) {
<a name="l00589"></a>00589   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00590"></a>00590   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00591"></a>00591   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ac44dea528550faf12da0bbdf362e59b">create_readdir_request</a>(name));
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">try</span> {
<a name="l00594"></a>00594     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00597"></a>00597       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00598"></a>00598                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <a class="code" href="class_hypertable_1_1_filesystem.html#cc7ee5b030c9bcc40c2590d438058da3" title="Decodes the response from a readdir request.">decode_response_readdir</a>(event_ptr, listing);
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00603"></a>00603     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error reading directory entries for DFS "</span>
<a name="l00604"></a>00604                <span class="stringliteral">"directory: %s"</span>, name.c_str());
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="keywordtype">void</span>
<a name="l00610"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8d34ff53d9f6ffcbae1a3e37882744e7">00610</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8d34ff53d9f6ffcbae1a3e37882744e7" title="Determines if a file exists asynchronously.">Client::exists</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00611"></a>00611   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#6f0d5a196f17d9a96b8d9e116deeb701">create_exists_request</a>(name));
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00614"></a>00614   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00615"></a>00615     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"sending 'exists' request for DFS path: %s"</span>,
<a name="l00616"></a>00616                name.c_str());
<a name="l00617"></a>00617   }
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="keywordtype">bool</span>
<a name="l00622"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#ce5b2b01c10b6e2914ebe67a6fe87d4b">00622</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#8d34ff53d9f6ffcbae1a3e37882744e7" title="Determines if a file exists asynchronously.">Client::exists</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;name) {
<a name="l00623"></a>00623   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00624"></a>00624   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00625"></a>00625   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#6f0d5a196f17d9a96b8d9e116deeb701">create_exists_request</a>(name));
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keywordflow">try</span> {
<a name="l00628"></a>00628     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00631"></a>00631       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00632"></a>00632                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_filesystem.html#8fe8de0c97b927031e7f86e969bd5e3e" title="Decodes the response from an exists request.">decode_response_exists</a>(event_ptr);
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00637"></a>00637     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error checking existence of DFS path: %s"</span>,
<a name="l00638"></a>00638                name.c_str());
<a name="l00639"></a>00639   }
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 <span class="keywordtype">void</span>
<a name="l00644"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#49565555038bb233bd711923fd31aaed">00644</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#49565555038bb233bd711923fd31aaed" title="Rename path asynchronously.">Client::rename</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;src, <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00645"></a>00645   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#fe7a5ac41e21dbfde38445f73663d419">create_rename_request</a>(src, dst));
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00648"></a>00648   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00649"></a>00649     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending 'rename' request for DFS "</span>
<a name="l00650"></a>00650                <span class="stringliteral">"path: %s -&gt; %s"</span>, src.c_str(), dst.c_str());
<a name="l00651"></a>00651   }
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="keywordtype">void</span>
<a name="l00656"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b02b8b9c62078085aff51c4a98442bde">00656</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#49565555038bb233bd711923fd31aaed" title="Rename path asynchronously.">Client::rename</a>(<span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;src, <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>) {
<a name="l00657"></a>00657   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00658"></a>00658   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00659"></a>00659   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#fe7a5ac41e21dbfde38445f73663d419">create_rename_request</a>(src, dst));
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <span class="keywordflow">try</span> {
<a name="l00662"></a>00662     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00665"></a>00665       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00666"></a>00666                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00669"></a>00669     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error renaming of DFS path: %s -&gt; %s"</span>,
<a name="l00670"></a>00670                src.c_str(), dst.c_str());
<a name="l00671"></a>00671   }
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 <span class="keywordtype">void</span>
<a name="l00676"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#7270d716f24d1af1901d6ee5e3fca444">00676</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b3ace6b412e3645ef158609f0287623a" title="Invokes debug request asynchronously.">Client::debug</a>(int32_t command, <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> &amp;serialized_parameters,
<a name="l00677"></a>00677               <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00678"></a>00678   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ed7bad62e99e1bca6c1aa6bd82ab803e">create_debug_request</a>(command,
<a name="l00679"></a>00679                  serialized_parameters));
<a name="l00680"></a>00680 
<a name="l00681"></a>00681   <span class="keywordflow">try</span> { <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, handler); }
<a name="l00682"></a>00682   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00683"></a>00683     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending debug command %d request"</span>, command);
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="keywordtype">void</span>
<a name="l00689"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b3ace6b412e3645ef158609f0287623a">00689</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#b3ace6b412e3645ef158609f0287623a" title="Invokes debug request asynchronously.">Client::debug</a>(int32_t command, <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> &amp;serialized_parameters) {
<a name="l00690"></a>00690   <a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html" title="This class is a DispatchHandler class that can be used by a client to synchronize...">DispatchHandlerSynchronizer</a> sync_handler;
<a name="l00691"></a>00691   <a class="code" href="namespace_hypertable.html#a8cafde9646a93ee97cfb6b26a9ec9b2">EventPtr</a> event_ptr;
<a name="l00692"></a>00692   <a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> cbp(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_protocol.html#ed7bad62e99e1bca6c1aa6bd82ab803e">create_debug_request</a>(command,
<a name="l00693"></a>00693                  serialized_parameters));
<a name="l00694"></a>00694 
<a name="l00695"></a>00695   <span class="keywordflow">try</span> {
<a name="l00696"></a>00696     <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">send_message</a>(cbp, &amp;sync_handler);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="keywordflow">if</span> (!sync_handler.<a class="code" href="class_hypertable_1_1_dispatch_handler_synchronizer.html#8db4bb995a8c2632c5e704e0a97d0667" title="This method is used by a client to synchronize.">wait_for_reply</a>(event_ptr))
<a name="l00699"></a>00699       <a class="code" href="_error_8h.html#7d401d8c606e7f717e3b1ae0452895c8">HT_THROW</a>(<a class="code" href="class_hypertable_1_1_protocol.html#6d98deec5dca167978eadfa078b03ab9">Protocol::response_code</a>(event_ptr.get()),
<a name="l00700"></a>00700                <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#043fc7db22e4ab960ce18e613e4d4ca2">m_protocol</a>.<a class="code" href="class_hypertable_1_1_protocol.html#2713455aaf3d892163ab7be0e1859327">string_format_message</a>(event_ptr).c_str());
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702   <span class="keywordflow">catch</span> (<a class="code" href="class_hypertable_1_1_exception.html" title="This is a generic exception class for Hypertable.">Exception</a> &amp;e) {
<a name="l00703"></a>00703     <a class="code" href="_error_8h.html#e61e8974d9d73f82af9b9597f21d194f">HT_THROW2F</a>(e.<a class="code" href="class_hypertable_1_1_exception.html#160a1277f173192e3b7993f60323a00b">code</a>(), e, <span class="stringliteral">"Error sending debug command %d request"</span>, command);
<a name="l00704"></a>00704   }
<a name="l00705"></a>00705 }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="keywordtype">void</span>
<a name="l00710"></a><a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24">00710</a> <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#5c20dc8ba368ba356107bf5cd5482e24" title="Sends a message to the DFS broker.">Client::send_message</a>(<a class="code" href="namespace_hypertable.html#af375d92595688fe01237202c19367ea">CommBufPtr</a> &amp;cbp, <a class="code" href="class_hypertable_1_1_dispatch_handler.html" title="Abstract base class that is the main callback class of the Comm layer.">DispatchHandler</a> *handler) {
<a name="l00711"></a>00711   <span class="keywordtype">int</span> error = <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e23b8dd22571bf11530123c48e2f8e84">m_comm</a>-&gt;<a class="code" href="class_hypertable_1_1_comm.html#cceb4d213c3db795b15a7118114cae8b" title="Sends a request message over a connection, expecting a response.">send_request</a>(<a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#e4ab0092e00b8a88d17fbfae1ecc133a">m_timeout_ms</a>, cbp, handler);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="keywordflow">if</span> (error != <a class="code" href="namespace_hypertable_1_1_error.html#73c48f53deb2941a8c0ef156a899c3b20a5285a55ffe0563faf08208db78e4a6">Error::OK</a>)
<a name="l00714"></a>00714     <a class="code" href="_error_8h.html#a274083bca13ee78497570285c908c80">HT_THROWF</a>(error, <span class="stringliteral">"DFS send_request to %s failed"</span>, <a class="code" href="class_hypertable_1_1_dfs_broker_1_1_client.html#d38135ee0619906a3131f18805403b94">m_addr</a>.<a class="code" href="struct_hypertable_1_1_inet_addr.html#2fb8f62a3e54cf558d93b9914f1a6dc4">format</a>().c_str());
<a name="l00715"></a>00715 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Aug 15 08:52:17 2009 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
