<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: /Users/doug/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreBlockIndexMap.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5708de38a757cb70589c505d18009990.html">doug</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a5f6cd2e2a2b5320bbe75e5c719f1fee.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_752ad1e2f45ee7988941467b4eccee0e.html">hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9031e3d7c38caf639b0143600d70b482.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5aae9766518c5969fd00e3382787720.html">cc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_3be4c2a439d9f674975a3d94c602c8e3.html">Hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_b6724abc6b41a2670a831834f82498af.html">RangeServer</a>
  </div>
</div>
<div class="contents">
<h1>CellStoreBlockIndexMap.h</h1><a href="_cell_store_block_index_map_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef HYPERTABLE_CELLSTOREBLOCKINDEXMAP_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define HYPERTABLE_CELLSTOREBLOCKINDEXMAP_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="_static_buffer_8h.html">Common/StaticBuffer.h</a>"</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="_serialized_key_8h.html">Hypertable/Lib/SerializedKey.h</a>"</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">namespace </span>Hypertable {
<a name="l00035"></a>00035 
<a name="l00039"></a>00039   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> OffsetT&gt;
<a name="l00040"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html">00040</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap</a> {
<a name="l00041"></a>00041   <span class="keyword">public</span>:
<a name="l00042"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6e589486b395331b0ea38c6be7ad17c8">00042</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> std::map&lt;const SerializedKey, OffsetT&gt;::iterator <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6e589486b395331b0ea38c6be7ad17c8">MapIteratorT</a>;
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#a1f2f9625ae48dd17c1ab71d34036218">00044</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#a1f2f9625ae48dd17c1ab71d34036218">CellStoreBlockIndexIteratorMap</a>() { }
<a name="l00045"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#1df9ac443c61a2e86f45330fe5b77fd7">00045</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#1df9ac443c61a2e86f45330fe5b77fd7">CellStoreBlockIndexIteratorMap</a>(<a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6e589486b395331b0ea38c6be7ad17c8">MapIteratorT</a> iter) : <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a>(iter) { }
<a name="l00046"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#5f3776724282aebb7aae8d86674fc0e8">00046</a>     <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#5f3776724282aebb7aae8d86674fc0e8">key</a>() { <span class="keywordflow">return</span> (*m_iter).first; }
<a name="l00047"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#a1ea1d12a71f4a0594b3b0709b93902a">00047</a>     int64_t <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#a1ea1d12a71f4a0594b3b0709b93902a">value</a>() { <span class="keywordflow">return</span> (int64_t)(*m_iter).second; }
<a name="l00048"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#bc2f2e082e3824e1d76d3e38a920dbe9">00048</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap</a> &amp;<a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#bc2f2e082e3824e1d76d3e38a920dbe9">operator++</a>() { ++<a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a>; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00049"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#8e120ded7171b0f2a6f7692281155bdb">00049</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#8e120ded7171b0f2a6f7692281155bdb">operator++</a>(<span class="keywordtype">int</span>) { 
<a name="l00050"></a>00050       <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap&lt;OffsetT&gt;</a> <a class="code" href="namespace_hypertable.html#c6963a6498b26e7052b0929dafdb2ce5">copy</a>(*<span class="keyword">this</span>);
<a name="l00051"></a>00051       ++(*this);
<a name="l00052"></a>00052       <span class="keywordflow">return</span> copy;
<a name="l00053"></a>00053     }
<a name="l00054"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#eea21fc2cb2d5d0e7d90bb2f33cfb2c5">00054</a>     <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#eea21fc2cb2d5d0e7d90bb2f33cfb2c5">operator==</a>(<span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap</a> &amp;other) {
<a name="l00055"></a>00055       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a> == other.<a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a>;
<a name="l00056"></a>00056     }
<a name="l00057"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6cba4a38f40c06969f2dc0dfbd2b2cae">00057</a>     <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6cba4a38f40c06969f2dc0dfbd2b2cae">operator!=</a>(<span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">CellStoreBlockIndexIteratorMap</a> &amp;other) {
<a name="l00058"></a>00058       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a> != other.<a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a>;
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060   <span class="keyword">protected</span>:
<a name="l00061"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">00061</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#6e589486b395331b0ea38c6be7ad17c8">MapIteratorT</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html#d320f0dea871be9825310f965f30eb42">m_iter</a>;
<a name="l00062"></a>00062   };
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00068"></a>00068   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> OffsetT&gt;
<a name="l00069"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html">00069</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html">CellStoreBlockIndexMap</a> {
<a name="l00070"></a>00070   <span class="keyword">public</span>:
<a name="l00071"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e486e4acca18e6fd876200b7dcee4516">00071</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">Hypertable::CellStoreBlockIndexIteratorMap&lt;OffsetT&gt;</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">iterator</a>;
<a name="l00072"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#dfc90c44f371f698ef1a496fc5d5bc39">00072</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> std::map&lt;const SerializedKey, OffsetT&gt; <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#dfc90c44f371f698ef1a496fc5d5bc39">MapT</a>;
<a name="l00073"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#375e4d82855c329ae084e1ad4b703da5">00073</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> std::map&lt;const SerializedKey, OffsetT&gt;::iterator <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#375e4d82855c329ae084e1ad4b703da5">MapIteratorT</a>;
<a name="l00074"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0a69eb2be9eb6de56c53079314fbb197">00074</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> std::map&lt;const SerializedKey, OffsetT&gt;::value_type <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0a69eb2be9eb6de56c53079314fbb197">value_type</a>;
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#8b63d4ec262a97204ae497f242aa28be">00076</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#8b63d4ec262a97204ae497f242aa28be">CellStoreBlockIndexMap</a>() : <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#7dd1172bb682f32e76be3b49a4610836">m_disk_used</a>(0) { }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#d7be6e3a0b1714f6867650488d5c62b5">00078</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#d7be6e3a0b1714f6867650488d5c62b5">load</a>(<a class="code" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;fixed, <a class="code" href="class_hypertable_1_1_dynamic_buffer.html">DynamicBuffer</a> &amp;variable,int64_t end_of_data,
<a name="l00079"></a>00079               <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;start_row=<span class="stringliteral">""</span>, <span class="keyword">const</span> <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;end_row=<span class="stringliteral">""</span>) {
<a name="l00080"></a>00080       <span class="keywordtype">size_t</span> total_entries = fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#63691b7eae8f01678606c60e69983471">fill</a>() / <span class="keyword">sizeof</span>(OffsetT);
<a name="l00081"></a>00081       <span class="keywordtype">size_t</span> index_entries = total_entries;
<a name="l00082"></a>00082       <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a> key;
<a name="l00083"></a>00083       OffsetT offset;
<a name="l00084"></a>00084       <span class="keyword">const</span> uint8_t *key_ptr;
<a name="l00085"></a>00085       <span class="keywordtype">bool</span> in_scope = (start_row == <span class="stringliteral">""</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00086"></a>00086       <span class="keywordtype">bool</span> check_for_end_row = end_row != <span class="stringliteral">""</span>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       assert(variable.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#07f4da024eb7e1285978c4412d09dc45">own</a>);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090       <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a> = end_of_data;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092       <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a> = variable;
<a name="l00093"></a>00093       fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#75bf05f5ca8497b2b53a744b8aa051a8">ptr</a> = fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#ef7acccec46adcb90a926977a61e99a4">base</a>;
<a name="l00094"></a>00094       key_ptr   = <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#4556ecd07eda8b67d638f84c313ae2ec">base</a>;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;index_entries; ++i) {
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="comment">// variable portion</span>
<a name="l00099"></a>00099         key.<a class="code" href="class_hypertable_1_1_byte_string.html#538ec5b176600856cab1646d59be7034">ptr</a> = key_ptr;
<a name="l00100"></a>00100         key_ptr += key.<a class="code" href="class_hypertable_1_1_byte_string.html#9220bf75429b9574f5f346fa47049055">length</a>();
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">// fixed portion (e.g. offset)</span>
<a name="l00103"></a>00103         memcpy(&amp;offset, fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#75bf05f5ca8497b2b53a744b8aa051a8">ptr</a>, <span class="keyword">sizeof</span>(offset));
<a name="l00104"></a>00104         fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#75bf05f5ca8497b2b53a744b8aa051a8">ptr</a> += <span class="keyword">sizeof</span>(offset);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span> (!in_scope) {
<a name="l00107"></a>00107           <span class="keywordflow">if</span> (strcmp(key.<a class="code" href="class_hypertable_1_1_serialized_key.html#78f46a8a96c124a6105dd38904bc1984">row</a>(), start_row.c_str()) &lt; 0)
<a name="l00108"></a>00108             <span class="keywordflow">continue</span>;
<a name="l00109"></a>00109           in_scope = <span class="keyword">true</span>;
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (check_for_end_row &amp;&amp; 
<a name="l00112"></a>00112                  strcmp(key.<a class="code" href="class_hypertable_1_1_serialized_key.html#78f46a8a96c124a6105dd38904bc1984">row</a>(), end_row.c_str()) &gt; 0) {
<a name="l00113"></a>00113           <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.insert(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.end(), <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0a69eb2be9eb6de56c53079314fbb197">value_type</a>(key, offset));
<a name="l00114"></a>00114           <span class="keywordflow">if</span> (i+1 &lt; index_entries) {
<a name="l00115"></a>00115             key.<a class="code" href="class_hypertable_1_1_byte_string.html#538ec5b176600856cab1646d59be7034">ptr</a> = key_ptr;
<a name="l00116"></a>00116             key_ptr += key.<a class="code" href="class_hypertable_1_1_byte_string.html#9220bf75429b9574f5f346fa47049055">length</a>();
<a name="l00117"></a>00117             memcpy(&amp;<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a>, fixed.<a class="code" href="class_hypertable_1_1_dynamic_buffer.html#75bf05f5ca8497b2b53a744b8aa051a8">ptr</a>, <span class="keyword">sizeof</span>(offset));
<a name="l00118"></a>00118           }
<a name="l00119"></a>00119           <span class="keywordflow">break</span>;
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.insert(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.end(), <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0a69eb2be9eb6de56c53079314fbb197">value_type</a>(key, offset));
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125       <a class="code" href="_logger_8h.html#cf985e8f1a1bebe7d622115e4b3e08a6">HT_ASSERT</a>(key_ptr &lt;= (<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#4556ecd07eda8b67d638f84c313ae2ec">base</a> + <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a>));
<a name="l00126"></a>00126       
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (!<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.empty()) {
<a name="l00128"></a>00128 
<a name="l00130"></a>00130         <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#7dd1172bb682f32e76be3b49a4610836">m_disk_used</a> = <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a> - (*<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.begin()).second;
<a name="l00131"></a>00131 
<a name="l00133"></a>00133         <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#375e4d82855c329ae084e1ad4b703da5">MapIteratorT</a> iter = <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.begin();
<a name="l00134"></a>00134         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=1; i&lt;(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.size()+1)/2; ++iter,++i)
<a name="l00135"></a>00135           ;
<a name="l00136"></a>00136         <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0b467a89bb05d8a2731002f3f9b2ffb2">m_middle_key</a> = (*iter).first;
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#46b4366ad565343d8eac8241785574e7">00141</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#46b4366ad565343d8eac8241785574e7">display</a>() {
<a name="l00142"></a>00142       <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a> last_key;
<a name="l00143"></a>00143       int64_t last_offset = 0;
<a name="l00144"></a>00144       int64_t block_size;
<a name="l00145"></a>00145       <span class="keywordtype">size_t</span> i=0;
<a name="l00146"></a>00146       <span class="keywordflow">for</span> (<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#375e4d82855c329ae084e1ad4b703da5">MapIteratorT</a> iter = <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.begin(); iter != <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.end(); ++iter) {
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (last_key) {
<a name="l00148"></a>00148           block_size = (*iter).second - last_offset;
<a name="l00149"></a>00149           std::cout &lt;&lt; i &lt;&lt; <span class="stringliteral">": offset="</span> &lt;&lt; last_offset &lt;&lt; <span class="stringliteral">" size="</span> &lt;&lt; block_size
<a name="l00150"></a>00150                     &lt;&lt; <span class="stringliteral">" row="</span> &lt;&lt; last_key.<a class="code" href="class_hypertable_1_1_serialized_key.html#78f46a8a96c124a6105dd38904bc1984">row</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
<a name="l00151"></a>00151           i++;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153         last_offset = (*iter).second;
<a name="l00154"></a>00154         last_key = (*iter).first;
<a name="l00155"></a>00155       }
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (last_key) {
<a name="l00157"></a>00157         block_size = <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a> - last_offset;
<a name="l00158"></a>00158         std::cout &lt;&lt; i &lt;&lt; <span class="stringliteral">": offset="</span> &lt;&lt; last_offset &lt;&lt; <span class="stringliteral">" size="</span> &lt;&lt; block_size
<a name="l00159"></a>00159                   &lt;&lt; <span class="stringliteral">" row="</span> &lt;&lt; last_key.<a class="code" href="class_hypertable_1_1_serialized_key.html#78f46a8a96c124a6105dd38904bc1984">row</a>() &lt;&lt; std::endl;
<a name="l00160"></a>00160       }
<a name="l00161"></a>00161       std::cout &lt;&lt; <span class="stringliteral">"sizeof(OffsetT) = "</span> &lt;&lt; <span class="keyword">sizeof</span>(OffsetT) &lt;&lt; std::endl;
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#46fba553f88b643ad2fcc243baae5d32">00164</a>     <span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#46fba553f88b643ad2fcc243baae5d32">middle_key</a>() { <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0b467a89bb05d8a2731002f3f9b2ffb2">m_middle_key</a>; }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#04153b4a3bd558c86adde5d6fc48a5c4">00166</a>     <span class="keywordtype">size_t</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#04153b4a3bd558c86adde5d6fc48a5c4">memory_used</a>() { <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a> + (<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.size() * 32); }
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#36901c5a587549acb06ca3e0f8ab5282">00168</a>     int64_t <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#36901c5a587549acb06ca3e0f8ab5282">disk_used</a>() { <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#7dd1172bb682f32e76be3b49a4610836">m_disk_used</a>; }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c08f065b0e419fd4195d8a9d72172402">00170</a>     int64_t <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c08f065b0e419fd4195d8a9d72172402">end_of_last_block</a>() { <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a>; }
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#976097d070cb77ed9c9328de2e8f1f7e">00172</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">iterator</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#976097d070cb77ed9c9328de2e8f1f7e">begin</a>() {
<a name="l00173"></a>00173       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e486e4acca18e6fd876200b7dcee4516">iterator</a>(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.begin());
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e9a708095cba25e0fe9778dbba906be0">00176</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">iterator</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e9a708095cba25e0fe9778dbba906be0">end</a>() {
<a name="l00177"></a>00177       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e486e4acca18e6fd876200b7dcee4516">iterator</a>(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.end());
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#6150b4e2cc6528ee0cfb8670f6b9d0dc">00180</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">iterator</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#6150b4e2cc6528ee0cfb8670f6b9d0dc">lower_bound</a>(<span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a>&amp; k) {
<a name="l00181"></a>00181       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e486e4acca18e6fd876200b7dcee4516">iterator</a>(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.lower_bound(k));
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ea3eadec6a7722f85f8d1f1d679d6f62">00184</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_iterator_map.html" title="Provides an STL-style iterator on CellStoreBlockIndex objects.">iterator</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ea3eadec6a7722f85f8d1f1d679d6f62">upper_bound</a>(<span class="keyword">const</span> <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a>&amp; k) {
<a name="l00185"></a>00185       <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#e486e4acca18e6fd876200b7dcee4516">iterator</a>(<a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.upper_bound(k));
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#14e3e306ae94f400f37a2629e468950b">00188</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#14e3e306ae94f400f37a2629e468950b">clear</a>() {
<a name="l00189"></a>00189       <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>.clear();
<a name="l00190"></a>00190       <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#fbd5fddc1e80e004dc4739bf6e9d46a2">free</a>();
<a name="l00191"></a>00191       <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0b467a89bb05d8a2731002f3f9b2ffb2">m_middle_key</a>.<a class="code" href="class_hypertable_1_1_byte_string.html#538ec5b176600856cab1646d59be7034">ptr</a> = 0;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keyword">private</span>:
<a name="l00195"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">00195</a>     <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#dfc90c44f371f698ef1a496fc5d5bc39">MapT</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#ef045e198d24612dac567989a4bac845">m_map</a>;
<a name="l00196"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">00196</a>     <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#c1d6a9a544070157cff5579d237a4127">m_keydata</a>;
<a name="l00197"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0b467a89bb05d8a2731002f3f9b2ffb2">00197</a>     <a class="code" href="class_hypertable_1_1_serialized_key.html">SerializedKey</a> <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#0b467a89bb05d8a2731002f3f9b2ffb2">m_middle_key</a>;
<a name="l00198"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">00198</a>     int64_t <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#65778242d5c6a600a82b6551ed351192">m_end_of_last_block</a>;
<a name="l00199"></a><a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#7dd1172bb682f32e76be3b49a4610836">00199</a>     int64_t <a class="code" href="class_hypertable_1_1_cell_store_block_index_map.html#7dd1172bb682f32e76be3b49a4610836">m_disk_used</a>;
<a name="l00200"></a>00200   };
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 } <span class="comment">// namespace Hypertable</span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="preprocessor">#endif // HYPERTABLE_CELLSTOREBLOCKINDEXMAP_H</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Aug 15 08:52:19 2009 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
