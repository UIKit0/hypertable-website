<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: /Users/doug/src/hypertable/src/cc/AsyncComm/CommBuf.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5708de38a757cb70589c505d18009990.html">doug</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a5f6cd2e2a2b5320bbe75e5c719f1fee.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_752ad1e2f45ee7988941467b4eccee0e.html">hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9031e3d7c38caf639b0143600d70b482.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5aae9766518c5969fd00e3382787720.html">cc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e65477d41cbea77146d554d167dc9746.html">AsyncComm</a></div>
<h1>CommBuf.h</h1><a href="_comm_buf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef HYPERTABLE_COMMBUF_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define HYPERTABLE_COMMBUF_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="_string_8h.html">string.h</a>&gt;</span>
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="_byte_string_8h.html">Common/ByteString.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="_logger_8h.html">Common/Logger.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="_serialization_8h.html">Common/Serialization.h</a>"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "<a class="code" href="_static_buffer_8h.html">Common/StaticBuffer.h</a>"</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include "<a class="code" href="_header_builder_8h.html">HeaderBuilder.h</a>"</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">namespace </span>Hypertable {
<a name="l00043"></a>00043 
<a name="l00073"></a><a class="code" href="class_hypertable_1_1_comm_buf.html">00073</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_comm_buf.html" title="Message buffer sent over the network by the AsyncComm subsystem.">CommBuf</a> {
<a name="l00074"></a>00074   <span class="keyword">public</span>:
<a name="l00075"></a>00075 
<a name="l00088"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#8b70e6eb9cbd8545aff72b3b274af04a">00088</a>     <a class="code" href="class_hypertable_1_1_comm_buf.html#8b70e6eb9cbd8545aff72b3b274af04a" title="This constructor initializes the CommBuf object by allocating a primary buffer of...">CommBuf</a>(<a class="code" href="class_hypertable_1_1_header_builder.html" title="Builds a response or request header for messages sent over the Comm layer.">HeaderBuilder</a> &amp;hbuilder, uint32_t <a class="code" href="_range_server_8cc.html#7360b55975153b822efc5217b7734e6a">len</a>) : <a class="code" href="class_hypertable_1_1_comm_buf.html#bc6eadb91e4d2551a7d783130200f45a">ext_ptr</a>(0) {
<a name="l00089"></a>00089       len += hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#a174cad7aa956693a6f9d461579ea9db" title="Returns the length of the header that would be generated.">header_length</a>();
<a name="l00090"></a>00090       <a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a> = <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a> = <span class="keyword">new</span> uint8_t [ len ];
<a name="l00091"></a>00091       <a class="code" href="class_hypertable_1_1_comm_buf.html#939abf1a1ff697654629345a00cffe53">dataLen</a> = len;
<a name="l00092"></a>00092       hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#529aebdda14181793824bffe6252bfcd" title="Sets the total length of the message.">set_total_len</a>(len);
<a name="l00093"></a>00093       hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#4e3ec38f01eb80b0309b40e364acf0af" title="Encodes the header to the given buffer.">encode</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>);
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095 
<a name="l00109"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#112836123ce334008f5bbe5829f1eab7">00109</a>     <a class="code" href="class_hypertable_1_1_comm_buf.html#8b70e6eb9cbd8545aff72b3b274af04a" title="This constructor initializes the CommBuf object by allocating a primary buffer of...">CommBuf</a>(<a class="code" href="class_hypertable_1_1_header_builder.html" title="Builds a response or request header for messages sent over the Comm layer.">HeaderBuilder</a> &amp;hbuilder, uint32_t <a class="code" href="_range_server_8cc.html#7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> &amp;buffer) : <a class="code" href="class_hypertable_1_1_comm_buf.html#6dcd4e9b650ed557fbf60275fc71c54e">ext</a>(buffer) {
<a name="l00110"></a>00110       len += hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#a174cad7aa956693a6f9d461579ea9db" title="Returns the length of the header that would be generated.">header_length</a>();
<a name="l00111"></a>00111       <a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a> = <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a> = <span class="keyword">new</span> uint8_t [ len ];
<a name="l00112"></a>00112       <a class="code" href="class_hypertable_1_1_comm_buf.html#939abf1a1ff697654629345a00cffe53">dataLen</a> = len;
<a name="l00113"></a>00113       hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#529aebdda14181793824bffe6252bfcd" title="Sets the total length of the message.">set_total_len</a>(len+buffer.<a class="code" href="class_hypertable_1_1_static_buffer.html#6548d44a4d3539650d3b90f423cc62b8">size</a>);
<a name="l00114"></a>00114       hbuilder.<a class="code" href="class_hypertable_1_1_header_builder.html#4e3ec38f01eb80b0309b40e364acf0af" title="Encodes the header to the given buffer.">encode</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>);
<a name="l00115"></a>00115       <a class="code" href="class_hypertable_1_1_comm_buf.html#bc6eadb91e4d2551a7d783130200f45a">ext_ptr</a> = <a class="code" href="class_hypertable_1_1_comm_buf.html#6dcd4e9b650ed557fbf60275fc71c54e">ext</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#4556ecd07eda8b67d638f84c313ae2ec">base</a>;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00121"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#13db6edb170d23e34fc7702ebbf5a619">00121</a>     <a class="code" href="class_hypertable_1_1_comm_buf.html#13db6edb170d23e34fc7702ebbf5a619" title="Destructor.">~CommBuf</a>() {
<a name="l00122"></a>00122       <span class="keyword">delete</span> [] <a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a>;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00131"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#93026c8c9f308b5c6c386f75000d7f1c">00131</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#93026c8c9f308b5c6c386f75000d7f1c" title="Resets the primary and extended data pointers to point to the beginning of their...">reset_data_pointers</a>() {
<a name="l00132"></a>00132       <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a> = (uint8_t *)<a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a>;
<a name="l00133"></a>00133       <a class="code" href="class_hypertable_1_1_comm_buf.html#bc6eadb91e4d2551a7d783130200f45a">ext_ptr</a> = <a class="code" href="class_hypertable_1_1_comm_buf.html#6dcd4e9b650ed557fbf60275fc71c54e">ext</a>.<a class="code" href="class_hypertable_1_1_static_buffer.html#4556ecd07eda8b67d638f84c313ae2ec">base</a>;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00139"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#03d3cfe793e0da0dcc3c53d6400bb97c">00139</a>     <span class="keywordtype">void</span> *<a class="code" href="class_hypertable_1_1_comm_buf.html#03d3cfe793e0da0dcc3c53d6400bb97c" title="Returns the primary buffer internal data pointer.">get_data_ptr</a>() { <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>; }
<a name="l00140"></a>00140 
<a name="l00144"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#dad1a6335589149b57725c5407b2f4c0">00144</a>     uint8_t **<a class="code" href="class_hypertable_1_1_comm_buf.html#dad1a6335589149b57725c5407b2f4c0" title="Returns address of the primary buffer internal data pointer.">get_data_ptr_address</a>() { <span class="keywordflow">return</span> &amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>; }
<a name="l00145"></a>00145 
<a name="l00152"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#99d9572f687c2e1762f2063971c04519">00152</a>     <span class="keywordtype">void</span> *<a class="code" href="class_hypertable_1_1_comm_buf.html#99d9572f687c2e1762f2063971c04519" title="Advance the primary buffer internal data pointer by len bytes.">advance_data_ptr</a>(<span class="keywordtype">size_t</span> <a class="code" href="_range_server_8cc.html#7360b55975153b822efc5217b7734e6a">len</a>) { <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a> += len; <span class="keywordflow">return</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>; }
<a name="l00153"></a>00153 
<a name="l00160"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#74fc9588ee7ac917a08a2088ff5e6bdc">00160</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#74fc9588ee7ac917a08a2088ff5e6bdc" title="Append a boolean value to the primary buffer, advancing the primary buffer internal...">append_bool</a>(<span class="keywordtype">bool</span> bval) { <a class="code" href="namespace_hypertable_1_1_serialization.html#5cf71fe45c648fab615820bc2bf50a4b" title="Encodes a boolean into the given buffer.">Serialization::encode_bool</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, bval); }
<a name="l00161"></a>00161 
<a name="l00168"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#65f263d103f7f58f57949464cc903dae">00168</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#65f263d103f7f58f57949464cc903dae" title="Append a byte of data to the primary buffer, advancing the primary buffer internal...">append_byte</a>(uint8_t bval) { *<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>++ = bval; }
<a name="l00169"></a>00169 
<a name="l00177"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#285014ebf96a8a315987d672bccd67ae">00177</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#285014ebf96a8a315987d672bccd67ae" title="Appends a sequence of bytes to the primary buffer, advancing the primary buffer internal...">append_bytes</a>(uint8_t *bytes, uint32_t <a class="code" href="_range_server_8cc.html#7360b55975153b822efc5217b7734e6a">len</a>) { memcpy(<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, bytes, len); <a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a> += len; }
<a name="l00178"></a>00178 
<a name="l00185"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#7ae6de7b2d5c4fa0f4180f5b5035994d">00185</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#7ae6de7b2d5c4fa0f4180f5b5035994d" title="Appends a short integer (16 bit) to the the primary buffer, advancing the primary...">append_short</a>(uint16_t sval) { <a class="code" href="namespace_hypertable_1_1_serialization.html#dd9bc4ec1b2319c867432466bf77b0d5" title="Encodes a short (2 byte integer) into the given buffer.">Serialization::encode_short</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, sval); }
<a name="l00186"></a>00186     
<a name="l00193"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#569ec8b8a8f7f7a45db727ff70220d60">00193</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#569ec8b8a8f7f7a45db727ff70220d60" title="Appends an integer (32 bit) to the the primary buffer, advancing the primary buffer...">append_int</a>(uint32_t ival) { <a class="code" href="namespace_hypertable_1_1_serialization.html#d656abc88dca985c946998e7bfb25dba" title="Encodes an int (4 byte integer) into the given buffer.">Serialization::encode_int</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, ival); }
<a name="l00194"></a>00194 
<a name="l00201"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#81f16e7674cb039c51f8b5ecc596b19f">00201</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#81f16e7674cb039c51f8b5ecc596b19f" title="Appends a long integer (64 bit) to the the primary buffer, advancing the primary...">append_long</a>(uint64_t lval) { <a class="code" href="namespace_hypertable_1_1_serialization.html#2faea11813bd892d8d0e77758f0a988b" title="Encodes a long (8 byte integer) into the given buffer.">Serialization::encode_long</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, lval); }
<a name="l00202"></a>00202 
<a name="l00211"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#b0ea9af5192a8bae96814453ef14e81b">00211</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#b0ea9af5192a8bae96814453ef14e81b" title="Appends a byte array to the primary buffer.">append_byte_array</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a>, int32_t <a class="code" href="_range_server_8cc.html#7360b55975153b822efc5217b7734e6a">len</a>) { <a class="code" href="namespace_hypertable_1_1_serialization.html#c8b69bf7b7b2c153c8e1d9ea502a782c" title="Encodes a variable sized byte array into the given buffer.">Serialization::encode_byte_array</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, data, len); }
<a name="l00212"></a>00212     
<a name="l00221"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#9b9017cc7fe0c609ee425c0f49594f3e">00221</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#9b9017cc7fe0c609ee425c0f49594f3e" title="Appends a c-style string to the primary buffer.">append_string</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str) { <a class="code" href="namespace_hypertable_1_1_serialization.html#e7ec45055aa109089bf33e1988c54741" title="Encodes a std::string into the given buffer.">Serialization::encode_string</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, str); }
<a name="l00222"></a>00222 
<a name="l00231"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#55fb420a85478ff7a31697c27c6b4290">00231</a>     <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_comm_buf.html#9b9017cc7fe0c609ee425c0f49594f3e" title="Appends a c-style string to the primary buffer.">append_string</a>(<span class="keyword">const</span> std::string &amp;str) { <a class="code" href="namespace_hypertable_1_1_serialization.html#e7ec45055aa109089bf33e1988c54741" title="Encodes a std::string into the given buffer.">Serialization::encode_string</a>(&amp;<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>, str.c_str()); }
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#725d9f10b2b72a47343521820ac26980">00233</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_i_o_handler_data.html">IOHandlerData</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">00235</a>     <span class="keyword">const</span> uint8_t *<a class="code" href="class_hypertable_1_1_comm_buf.html#54a73dafc3fcbcd56a41ad3ccad2680d">data</a>;
<a name="l00236"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#939abf1a1ff697654629345a00cffe53">00236</a>     uint32_t <a class="code" href="class_hypertable_1_1_comm_buf.html#939abf1a1ff697654629345a00cffe53">dataLen</a>;
<a name="l00237"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#6dcd4e9b650ed557fbf60275fc71c54e">00237</a>     <a class="code" href="class_hypertable_1_1_static_buffer.html">StaticBuffer</a> <a class="code" href="class_hypertable_1_1_comm_buf.html#6dcd4e9b650ed557fbf60275fc71c54e">ext</a>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keyword">protected</span>:
<a name="l00240"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">00240</a>     uint8_t *<a class="code" href="class_hypertable_1_1_comm_buf.html#b0c50b07a1bb144d5f0bb5b431a42748">dataPtr</a>;
<a name="l00241"></a><a class="code" href="class_hypertable_1_1_comm_buf.html#bc6eadb91e4d2551a7d783130200f45a">00241</a>     <span class="keyword">const</span> uint8_t *<a class="code" href="class_hypertable_1_1_comm_buf.html#bc6eadb91e4d2551a7d783130200f45a">ext_ptr</a>;
<a name="l00242"></a>00242   };
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="namespace_hypertable.html#b8eaad4b43f9b57c9a894a5db2b94989">00244</a>   <span class="keyword">typedef</span> boost::shared_ptr&lt;CommBuf&gt; <a class="code" href="namespace_hypertable.html#b8eaad4b43f9b57c9a894a5db2b94989">CommBufPtr</a>;
<a name="l00245"></a>00245   
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="preprocessor">#endif // HYPERTABLE_COMMBUF_H</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Fri May 23 14:50:25 2008 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
