<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>hypertable: /Users/doug/src/hypertable/src/cc/Hypertable/Lib/DataGeneratorRowComponent.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_9e51036813d6151dfecc72d5fa7c02b3.html">Users</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_5708de38a757cb70589c505d18009990.html">doug</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a5f6cd2e2a2b5320bbe75e5c719f1fee.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_752ad1e2f45ee7988941467b4eccee0e.html">hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9031e3d7c38caf639b0143600d70b482.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_f5aae9766518c5969fd00e3382787720.html">cc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_3be4c2a439d9f674975a3d94c602c8e3.html">Hypertable</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_ad5135801673f2e4c4e1be66fcd2e528.html">Lib</a>
  </div>
</div>
<div class="contents">
<h1>DataGeneratorRowComponent.h</h1><a href="_data_generator_row_component_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef HYPERTABLE_DATAGENERATORROWCOMPONENT_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define HYPERTABLE_DATAGENERATORROWCOMPONENT_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="_common_2_config_8h.html">Common/Config.h</a>"</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="_discrete_random_generator_factory_8h.html">Common/DiscreteRandomGeneratorFactory.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="_string_8h.html">Common/String.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include "<a class="code" href="_cell_8h.html">Cell.h</a>"</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">using namespace </span>Hypertable::Config;
<a name="l00042"></a>00042 <span class="keyword">using namespace </span>std;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">namespace </span>Hypertable {
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="namespace_hypertable.html#3255ea62d5d072b72f031e37c71707ab">00046</a>   <span class="keyword">enum</span> <a class="code" href="namespace_hypertable.html#3255ea62d5d072b72f031e37c71707ab">Type</a> { <a class="code" href="namespace_hypertable.html#3255ea62d5d072b72f031e37c71707abeb3317d95cccc8bb8a2936fb703c7ced">INTEGER</a>, <a class="code" href="namespace_hypertable.html#3255ea62d5d072b72f031e37c71707abd92fe725c568a3f108c45501b74438d8">STRING</a>, <a class="code" href="namespace_hypertable.html#3255ea62d5d072b72f031e37c71707abc915a528782003af936be4e28123e866">TIMESTAMP</a> };
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">00048</a>   <span class="keyword">enum</span> <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2">Order</a> { <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>, <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e23843281e7ea88038bdda71ba25de92ba">ASCENDING</a> };
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html">00050</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a> {
<a name="l00051"></a>00051   <span class="keyword">public</span>:
<a name="l00052"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#2361661b9491cd70c52883c21454fa50">00052</a>     <a class="code" href="class_hypertable_1_1_row_component_spec.html#2361661b9491cd70c52883c21454fa50">RowComponentSpec</a>() : <a class="code" href="class_hypertable_1_1_row_component_spec.html#405478119b3fdf6a7aacd6fb556da437">type</a>(-1), <a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a>(-1), <a class="code" href="class_hypertable_1_1_row_component_spec.html#aaccb8e4c756741c3c4ecfff114395ef">seed</a>(-1) { }
<a name="l00053"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#405478119b3fdf6a7aacd6fb556da437">00053</a>     <span class="keywordtype">int</span> <a class="code" href="class_hypertable_1_1_row_component_spec.html#405478119b3fdf6a7aacd6fb556da437">type</a>;
<a name="l00054"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">00054</a>     <span class="keywordtype">int</span> <a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a>;
<a name="l00055"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">00055</a>     <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> <a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a>;
<a name="l00056"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">00056</a>     <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> <a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a>;
<a name="l00057"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">00057</a>     <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> <a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a>;
<a name="l00058"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#aaccb8e4c756741c3c4ecfff114395ef">00058</a>     <span class="keywordtype">unsigned</span> <a class="code" href="class_hypertable_1_1_row_component_spec.html#aaccb8e4c756741c3c4ecfff114395ef">seed</a>;
<a name="l00059"></a><a class="code" href="class_hypertable_1_1_row_component_spec.html#35684d5615b658d5c013e82b0521a8d9">00059</a>     <a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> <a class="code" href="class_hypertable_1_1_row_component_spec.html#35684d5615b658d5c013e82b0521a8d9">distribution</a>;
<a name="l00060"></a>00060   };
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="class_hypertable_1_1_row_component.html">00062</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_row_component.html">RowComponent</a> : <span class="keyword">public</span> <a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a> {
<a name="l00063"></a>00063   <span class="keyword">public</span>:
<a name="l00064"></a><a class="code" href="class_hypertable_1_1_row_component.html#e13f556537b8eb5c4a24838902b89be2">00064</a>     <a class="code" href="class_hypertable_1_1_row_component.html#e13f556537b8eb5c4a24838902b89be2">RowComponent</a>(<a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a> &amp;spec) : <a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a>(spec) { 
<a name="l00065"></a>00065       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>) {
<a name="l00066"></a>00066         <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a> = <a class="code" href="class_hypertable_1_1_discrete_random_generator_factory.html#f00a14ecf572ea34a3551a80fdccffa3">DiscreteRandomGeneratorFactory::create</a>(spec.<a class="code" href="class_hypertable_1_1_row_component_spec.html#35684d5615b658d5c013e82b0521a8d9">distribution</a>);
<a name="l00067"></a>00067         <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>-&gt;set_seed(<a class="code" href="class_hypertable_1_1_row_component_spec.html#aaccb8e4c756741c3c4ecfff114395ef">seed</a>);
<a name="l00068"></a>00068       }
<a name="l00069"></a>00069     }
<a name="l00070"></a><a class="code" href="class_hypertable_1_1_row_component.html#1128a1d64eb06ecd1b88f7c9bab6b096">00070</a>     <span class="keyword">virtual</span> <a class="code" href="class_hypertable_1_1_row_component.html#1128a1d64eb06ecd1b88f7c9bab6b096">~RowComponent</a>() { }
<a name="l00071"></a>00071     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_row_component.html#f564743ab97da61063b4412de29eb428">next</a>() = 0;
<a name="l00072"></a>00072     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_row_component.html#6797c2e50360f5b5398f5ae5b481d7ed">render</a>(<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>) = 0;
<a name="l00073"></a>00073   <span class="keyword">protected</span>:
<a name="l00074"></a><a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">00074</a>     <a class="code" href="namespace_hypertable.html#6e02224d6abff5fd0b809369d1d00d32">DiscreteRandomGeneratorPtr</a> <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>;
<a name="l00075"></a>00075   };
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html">00077</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_row_component_integer.html">RowComponentInteger</a> : <span class="keyword">public</span> <a class="code" href="class_hypertable_1_1_row_component.html">RowComponent</a> {
<a name="l00078"></a>00078   <span class="keyword">public</span>:
<a name="l00079"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#68a08c0cbe9cf52d3380befb8e1cb87c">00079</a>     <a class="code" href="class_hypertable_1_1_row_component_integer.html#68a08c0cbe9cf52d3380befb8e1cb87c">RowComponentInteger</a>(<a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a> &amp;spec) : <a class="code" href="class_hypertable_1_1_row_component.html">RowComponent</a>(spec) {
<a name="l00080"></a>00080       <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a> = (<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a> != <span class="stringliteral">""</span>) ? strtoll(<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a>.c_str(), 0, 0) : 0;
<a name="l00081"></a>00081       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a> &lt; 0)
<a name="l00082"></a>00082         <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a> = 0;
<a name="l00083"></a>00083       <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a> = (<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a> != <span class="stringliteral">""</span>) ? strtoll(<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a>.c_str(), 0, 0) : std::numeric_limits&lt;int64_t&gt;::max();
<a name="l00084"></a>00084       <a class="code" href="_logger_8h.html#cf985e8f1a1bebe7d622115e4b3e08a6">HT_ASSERT</a>(<a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a> &lt; <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a>);
<a name="l00085"></a>00085       <a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a>;
<a name="l00086"></a>00086       <a class="code" href="class_hypertable_1_1_row_component_integer.html#9e9eb678f69af1253fc56c82fae861e0">m_diff</a> = <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a> - <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a>;
<a name="l00087"></a>00087       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>)
<a name="l00088"></a>00088         <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>-&gt;set_max(<a class="code" href="class_hypertable_1_1_row_component_integer.html#9e9eb678f69af1253fc56c82fae861e0">m_diff</a>);
<a name="l00089"></a>00089     }
<a name="l00090"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#a0f9abf27325a6f5620422947b5d9d42">00090</a>     <span class="keyword">virtual</span> <a class="code" href="class_hypertable_1_1_row_component_integer.html#a0f9abf27325a6f5620422947b5d9d42">~RowComponentInteger</a>() { }
<a name="l00091"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#4a5168614b2b3a319ef358afb1099489">00091</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_row_component_integer.html#4a5168614b2b3a319ef358afb1099489">next</a>() {
<a name="l00092"></a>00092       <span class="keywordtype">bool</span> rval = <span class="keyword">true</span>;
<a name="l00093"></a>00093       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e23843281e7ea88038bdda71ba25de92ba">ASCENDING</a>) {
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a> == <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a>) {
<a name="l00095"></a>00095           <a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a>;
<a name="l00096"></a>00096           rval = <span class="keyword">false</span>;
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098         <a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a>++;
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>) {
<a name="l00101"></a>00101         <a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a> + <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>-&gt;get_sample() % <a class="code" href="class_hypertable_1_1_row_component_integer.html#9e9eb678f69af1253fc56c82fae861e0">m_diff</a>;
<a name="l00102"></a>00102         rval = <span class="keyword">false</span>;
<a name="l00103"></a>00103       }
<a name="l00104"></a>00104       <span class="keywordflow">else</span>
<a name="l00105"></a>00105         <a class="code" href="_logger_8h.html#ebc5a83fddd222109e3ba3d1df730647">HT_FATAL</a>(<span class="stringliteral">"invalid order"</span>);
<a name="l00106"></a>00106       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a> != <span class="stringliteral">""</span>)
<a name="l00107"></a>00107         sprintf(<a class="code" href="class_hypertable_1_1_row_component_integer.html#249f4eb4174b40c16084f2045dc34bb8">m_render_buf</a>, <a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a>.c_str(), (<a class="code" href="namespace_hypertable.html#ce7eaaed51230ae858cf2843bc20cce5">Lld</a>)<a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a>);
<a name="l00108"></a>00108       <span class="keywordflow">else</span>
<a name="l00109"></a>00109         sprintf(<a class="code" href="class_hypertable_1_1_row_component_integer.html#249f4eb4174b40c16084f2045dc34bb8">m_render_buf</a>, <span class="stringliteral">"%lld"</span>, (<a class="code" href="namespace_hypertable.html#ce7eaaed51230ae858cf2843bc20cce5">Lld</a>)<a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a>);
<a name="l00110"></a>00110       <span class="keywordflow">return</span> rval;
<a name="l00111"></a>00111     }
<a name="l00112"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#be064c38c646a17802c6e56dc210030a">00112</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_row_component_integer.html#be064c38c646a17802c6e56dc210030a">render</a>(<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>) {
<a name="l00113"></a>00113       dst += (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="class_hypertable_1_1_row_component_integer.html#249f4eb4174b40c16084f2045dc34bb8">m_render_buf</a>;
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115   <span class="keyword">private</span>:
<a name="l00116"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">00116</a>     int64_t <a class="code" href="class_hypertable_1_1_row_component_integer.html#5f209a77ff9cf988092f528d6faa508f">m_min</a>, <a class="code" href="class_hypertable_1_1_row_component_integer.html#179a9f1a37872e80ea90674ad71035a9">m_max</a>, <a class="code" href="class_hypertable_1_1_row_component_integer.html#754f678264c069fd11686d8fefb5ca2c">m_next</a>, <a class="code" href="class_hypertable_1_1_row_component_integer.html#9e9eb678f69af1253fc56c82fae861e0">m_diff</a>;
<a name="l00117"></a><a class="code" href="class_hypertable_1_1_row_component_integer.html#249f4eb4174b40c16084f2045dc34bb8">00117</a>     <span class="keywordtype">char</span> <a class="code" href="class_hypertable_1_1_row_component_integer.html#249f4eb4174b40c16084f2045dc34bb8">m_render_buf</a>[32];
<a name="l00118"></a>00118   };
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html">00120</a>   <span class="keyword">class </span><a class="code" href="class_hypertable_1_1_row_component_timestamp.html">RowComponentTimestamp</a> : <span class="keyword">public</span> <a class="code" href="class_hypertable_1_1_row_component.html">RowComponent</a> {
<a name="l00121"></a>00121   <span class="keyword">public</span>:
<a name="l00122"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#0ad6deb04cb980dd009f310690a41c98">00122</a>     <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#0ad6deb04cb980dd009f310690a41c98">RowComponentTimestamp</a>(<a class="code" href="class_hypertable_1_1_row_component_spec.html">RowComponentSpec</a> &amp;spec) : <a class="code" href="class_hypertable_1_1_row_component.html">RowComponent</a>(spec) {
<a name="l00123"></a>00123       <span class="keyword">struct </span>tm tmval;
<a name="l00124"></a>00124       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a> != <span class="stringliteral">""</span>) {
<a name="l00125"></a>00125         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a> != <span class="stringliteral">""</span>) {
<a name="l00126"></a>00126           strptime(<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a>.c_str(), <a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a>.c_str(), &amp;tmval);
<a name="l00127"></a>00127           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> = mktime(&amp;tmval);
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129         <span class="keywordflow">else</span>
<a name="l00130"></a>00130           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> = 0;
<a name="l00131"></a>00131         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a> != <span class="stringliteral">""</span>) {
<a name="l00132"></a>00132           strptime(<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a>.c_str(), <a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a>.c_str(), &amp;tmval);
<a name="l00133"></a>00133           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a> = mktime(&amp;tmval);
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135         <span class="keywordflow">else</span>
<a name="l00136"></a>00136           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a> = <a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">std::numeric_limits&lt;time_t&gt;::max</a>();
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138       <span class="keywordflow">else</span> { 
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a> != <span class="stringliteral">""</span>) {
<a name="l00140"></a>00140           strptime(<a class="code" href="class_hypertable_1_1_row_component_spec.html#135ae88f93b0dc07148a9b1607c4a093">min</a>.c_str(), <span class="stringliteral">"%F %T"</span>, &amp;tmval);
<a name="l00141"></a>00141           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> = mktime(&amp;tmval);
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">else</span>
<a name="l00144"></a>00144           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> = 0;
<a name="l00145"></a>00145         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a> != <span class="stringliteral">""</span>) {
<a name="l00146"></a>00146           strptime(<a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">max</a>.c_str(), <span class="stringliteral">"%F %T"</span>, &amp;tmval);
<a name="l00147"></a>00147           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a> = mktime(&amp;tmval);
<a name="l00148"></a>00148         }
<a name="l00149"></a>00149         <span class="keywordflow">else</span>
<a name="l00150"></a>00150           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a> = <a class="code" href="class_hypertable_1_1_row_component_spec.html#3ffa64ab546205f5bc91083f6c699399">std::numeric_limits&lt;time_t&gt;::max</a>();
<a name="l00151"></a>00151       }
<a name="l00152"></a>00152       <a class="code" href="_logger_8h.html#cf985e8f1a1bebe7d622115e4b3e08a6">HT_ASSERT</a>(<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> &lt; <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a>);
<a name="l00153"></a>00153       <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a>;
<a name="l00154"></a>00154       <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#e53ec65cf8f9b08f64e898ba85d689d0">m_diff</a> = <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a> - <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a>;
<a name="l00155"></a>00155       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>)
<a name="l00156"></a>00156         <a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>-&gt;set_max(<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#e53ec65cf8f9b08f64e898ba85d689d0">m_diff</a>);
<a name="l00157"></a>00157     }
<a name="l00158"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#538e57ac9ea136bb5a56ea2d15d622c8">00158</a>     <span class="keyword">virtual</span> <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#538e57ac9ea136bb5a56ea2d15d622c8">~RowComponentTimestamp</a>() { }
<a name="l00159"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#4906b1d52776fad5e4ca0651e4ebc22d">00159</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#4906b1d52776fad5e4ca0651e4ebc22d">next</a>() {
<a name="l00160"></a>00160       <span class="keywordtype">bool</span> rval = <span class="keyword">true</span>;
<a name="l00161"></a>00161       <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e23843281e7ea88038bdda71ba25de92ba">ASCENDING</a>) {
<a name="l00162"></a>00162         <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a> == <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a>) {
<a name="l00163"></a>00163           <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a>;
<a name="l00164"></a>00164           rval = <span class="keyword">false</span>;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a>++;
<a name="l00167"></a>00167       }
<a name="l00168"></a>00168       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_hypertable_1_1_row_component_spec.html#f7ab415959b8dd82754fc3ee7c368642">order</a> == <a class="code" href="namespace_hypertable.html#f24bb8d04091fae85b7c1d58432545e2603aaef66808234d74c83076bb44fab3">RANDOM</a>) {
<a name="l00169"></a>00169         <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a> = <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a> + (time_t)(<a class="code" href="class_hypertable_1_1_row_component.html#7f17638f48c6d7e0bde95a111256a26d">m_rng</a>-&gt;get_sample() % <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#e53ec65cf8f9b08f64e898ba85d689d0">m_diff</a>);
<a name="l00170"></a>00170         rval = <span class="keyword">false</span>;
<a name="l00171"></a>00171       }
<a name="l00172"></a>00172       <span class="keywordflow">else</span>
<a name="l00173"></a>00173         <a class="code" href="_logger_8h.html#ebc5a83fddd222109e3ba3d1df730647">HT_FATAL</a>(<span class="stringliteral">"invalid order"</span>);
<a name="l00174"></a>00174       <span class="keyword">struct </span>tm tm_val;
<a name="l00175"></a>00175       <span class="keyword">const</span> <span class="keywordtype">char</span> *cformat = (<a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a> == <span class="stringliteral">""</span>) ? <span class="stringliteral">"%F %T"</span> : <a class="code" href="class_hypertable_1_1_row_component_spec.html#9eabd6998c363fd83a52622f47fcbfac">format</a>.c_str();
<a name="l00176"></a>00176       gmtime_r(&amp;<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a>, &amp;tm_val);
<a name="l00177"></a>00177       strftime(<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1f62264f048b27cf7bbbe97788399a7a">m_render_buf</a>, 32, cformat, &amp;tm_val);
<a name="l00178"></a>00178       <span class="keywordflow">return</span> rval;
<a name="l00179"></a>00179     }
<a name="l00180"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#71fb313f84da65aa14739e851d1c0c5e">00180</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#71fb313f84da65aa14739e851d1c0c5e">render</a>(<a class="code" href="namespace_hypertable.html#bd74d0aa26c0528285dc77325ca89511" title="We might want to use something better later, as std::string always causes a heap...">String</a> &amp;<a class="code" href="lzoconf_8h.html#19cbb22b1e5f063785152ae6b1755c18">dst</a>) {
<a name="l00181"></a>00181       dst += (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1f62264f048b27cf7bbbe97788399a7a">m_render_buf</a>;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183   <span class="keyword">private</span>:
<a name="l00184"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">00184</a>     time_t <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1ebb8e419c35295dfb979f90bc395015">m_min</a>, <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#9bb3d7067de47565c72617354947f2f0">m_max</a>, <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#417ccffb8a090b75f7d12f9a884c6747">m_next</a>;
<a name="l00185"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#e53ec65cf8f9b08f64e898ba85d689d0">00185</a>     int64_t <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#e53ec65cf8f9b08f64e898ba85d689d0">m_diff</a>;
<a name="l00186"></a><a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1f62264f048b27cf7bbbe97788399a7a">00186</a>     <span class="keywordtype">char</span> <a class="code" href="class_hypertable_1_1_row_component_timestamp.html#1f62264f048b27cf7bbbe97788399a7a">m_render_buf</a>[32];
<a name="l00187"></a>00187   };
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="preprocessor">#endif // HYPERTABLE_DATAGENERATORROWCOMPONENT_H</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Aug 15 08:52:18 2009 for hypertable by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
